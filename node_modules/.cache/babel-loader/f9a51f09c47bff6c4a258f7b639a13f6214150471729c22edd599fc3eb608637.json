{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\josep\\\\Documents\\\\Sistema de Encuestas por Voz\\\\client\\\\src\\\\pages\\\\TakeSurvey.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { SurveyService, ResponseService } from '../services/apiService';\n\n// Componentes\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport ErrorMessage from '../components/ErrorMessage';\nimport audioService from '../services/audioService';\n// Importar servicio de procesamiento de lenguaje natural\nimport * as nlpService from '../services/nlpService';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst TakeSurvey = () => {\n  _s();\n  const {\n    surveyId\n  } = useParams();\n  const navigate = useNavigate();\n\n  // Referencias para controlar el flujo de la conversaci贸n\n  const conversationActive = useRef(false);\n  const speakTimeoutRef = useRef(null);\n\n  // Estados\n  const [survey, setSurvey] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [responses, setResponses] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [currentResponse, setCurrentResponse] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const [voiceEnabled, setVoiceEnabled] = useState(true);\n  const [conversationState, setConversationState] = useState('idle'); // idle, speaking, listening, processing\n  const [conversationMessage, setConversationMessage] = useState('');\n  const [micPermission, setMicPermission] = useState('unknown'); // 'unknown', 'granted', 'denied'\n  const [recognizedText, setRecognizedText] = useState('');\n  const [status, setStatus] = useState('');\n  const [showPermissionDialog, setShowPermissionDialog] = useState(false);\n\n  // Verificar permiso del micr贸fono\n  const requestMicrophonePermission = async () => {\n    setConversationState('requesting_permission');\n    setConversationMessage('Solicitando permiso para el micr贸fono...');\n    try {\n      const permissionGranted = await audioService.requestMicrophonePermission();\n      if (permissionGranted) {\n        setMicPermission('granted');\n        setShowPermissionDialog(false);\n        setConversationMessage('Permiso concedido. Iniciando encuesta por voz...');\n\n        // Peque帽o retraso para iniciar la conversaci贸n\n        setTimeout(() => {\n          startConversation();\n        }, 1000);\n      } else {\n        setMicPermission('denied');\n        setConversationState('permission_denied');\n        setConversationMessage('Se necesita acceso al micr贸fono para usar la funci贸n de voz');\n      }\n    } catch (error) {\n      console.error('Error al solicitar permiso:', error);\n      setMicPermission('denied');\n      setConversationState('error');\n      setConversationMessage('Error al solicitar permiso del micr贸fono');\n    }\n  };\n\n  // Cargar la encuesta\n  useEffect(() => {\n    const fetchSurvey = async () => {\n      try {\n        const data = await SurveyService.getPublicSurvey(surveyId);\n        console.log('Encuesta cargada:', data);\n        setSurvey(data);\n        // Inicializar respuestas vac铆as\n        setResponses(new Array(data.questions.length).fill(''));\n      } catch (error) {\n        console.error('Error al cargar la encuesta:', error);\n        setError('No se pudo cargar la encuesta. Verifique que el ID sea correcto y que la encuesta est茅 activa.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchSurvey();\n\n    // Inicializar sistema de voz\n    audioService.initSpeechSystem();\n\n    // Configurar el callback para cambios en el permiso del micr贸fono\n    audioService.onPermissionChange((granted, errorMsg) => {\n      setMicPermission(granted ? 'granted' : 'denied');\n      if (!granted && errorMsg) {\n        setConversationMessage(`Error de permiso: ${errorMsg}`);\n        setConversationState('permission_denied');\n      }\n    });\n    return () => {\n      // Detener cualquier s铆ntesis y reconocimiento al desmontar\n      if (speakTimeoutRef.current) {\n        clearTimeout(speakTimeoutRef.current);\n      }\n      audioService.stop();\n      conversationActive.current = false;\n      if (window.speechSynthesis) {\n        window.speechSynthesis.cancel();\n      }\n    };\n  }, [surveyId]);\n\n  // Iniciar la conversaci贸n una vez que la encuesta est茅 cargada\n  useEffect(() => {\n    if (survey && voiceEnabled && !conversationActive.current) {\n      // Primero verificar permiso de micr贸fono\n      if (micPermission === 'granted') {\n        startConversation();\n      } else if (micPermission === 'unknown') {\n        // Mostrar di谩logo de permiso\n        setShowPermissionDialog(true);\n      }\n    }\n  }, [survey, voiceEnabled, micPermission]);\n\n  // Funci贸n para iniciar la conversaci贸n\n  const startConversation = () => {\n    if (!voiceEnabled || !survey) return;\n    conversationActive.current = true;\n\n    // Dar un mensaje de bienvenida\n    if (survey.welcomeMessage) {\n      speakText(survey.welcomeMessage, () => {\n        // Despu茅s de la bienvenida, preguntar la primera pregunta\n        speakCurrentQuestion();\n      });\n    } else {\n      // Si no hay mensaje de bienvenida, ir directamente a la primera pregunta\n      speakCurrentQuestion();\n    }\n  };\n\n  // Funci贸n para hablar el texto usando el servicio de audio con pausas naturales\n  const speakText = (text, onEndCallback) => {\n    if (!voiceEnabled) {\n      if (onEndCallback) onEndCallback();\n      return;\n    }\n\n    // Cancela cualquier s铆ntesis en curso y limpia los timeouts anteriores\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    if (speakTimeoutRef.current) {\n      clearTimeout(speakTimeoutRef.current);\n      speakTimeoutRef.current = null;\n    }\n\n    // Pausa breve antes de comenzar a hablar para evitar interrupciones\n    speakTimeoutRef.current = setTimeout(() => {\n      setConversationState('speaking');\n      setConversationMessage('Hablando: ' + text.substring(0, 30) + (text.length > 30 ? '...' : ''));\n\n      // Calcular un tiempo estimado basado en la longitud del texto (aproximadamente 80ms por car谩cter)\n      const estimatedSpeakTime = Math.max(3000, text.length * 80);\n      audioService.speakText(text, () => {\n        console.log('Hablando:', text);\n      }, () => {\n        console.log('Termin贸 de hablar');\n        setConversationState('idle');\n\n        // Esperar un tiempo m谩s largo despu茅s de hablar para una conversaci贸n m谩s natural\n        if (onEndCallback) {\n          speakTimeoutRef.current = setTimeout(onEndCallback, 1000);\n        }\n      }, error => {\n        console.error('Error al hablar:', error);\n        setConversationState('idle');\n\n        // En caso de error, esperar un poco antes de continuar\n        if (onEndCallback) {\n          speakTimeoutRef.current = setTimeout(onEndCallback, 1000);\n        }\n      });\n    }, 500); // Esperar 500ms antes de iniciar una nueva s铆ntesis\n  };\n\n  // Funci贸n para hablar la pregunta actual\n  const speakCurrentQuestion = () => {\n    if (!survey || !voiceEnabled) return;\n    const currentQuestion = survey.questions[currentQuestionIndex];\n    if (!currentQuestion) return;\n    let questionText = `Pregunta ${currentQuestionIndex + 1}: ${currentQuestion.text}`;\n\n    // Agregar informaci贸n sobre opciones si es pregunta de opci贸n m煤ltiple\n    if (currentQuestion.type === 'multiple_choice' && currentQuestion.options) {\n      questionText += '. Las opciones son: ';\n      questionText += currentQuestion.options.map((option, idx) => `Opci贸n ${idx + 1}: ${option}`).join(', ');\n    }\n    speakText(questionText, () => {\n      // Despu茅s de hablar la pregunta, iniciar el reconocimiento de voz\n      startListening();\n    });\n  };\n\n  // Funci贸n para iniciar la escucha de la respuesta del usuario\n  const startListening = async () => {\n    if (!voiceEnabled) return;\n    if (!audioService.isSupportedByBrowser()) {\n      setError('Tu navegador no soporta reconocimiento de voz');\n      return;\n    }\n    if (micPermission !== 'granted') {\n      await requestMicrophonePermission();\n      return;\n    }\n    audioService.init('es-ES');\n    setRecognizedText('');\n    audioService.onResult((transcript, isFinal) => {\n      setCurrentResponse(transcript);\n      setStatus(isFinal ? 'Procesando...' : 'Escuchando...');\n    });\n    audioService.onEnd(finalTranscript => {\n      setIsListening(false);\n      setConversationState('processing');\n      setConversationMessage('Procesando respuesta...');\n\n      // Guardar la respuesta y continuar la conversaci贸n\n      handleVoiceResponse(finalTranscript);\n    });\n    audioService.onError(errorMessage => {\n      console.error('Error de reconocimiento:', errorMessage);\n      setError(`Error de reconocimiento: ${errorMessage}`);\n      setIsListening(false);\n      setConversationState('idle');\n\n      // Reintentar la escucha despu茅s de un error\n      speakTimeoutRef.current = setTimeout(() => {\n        speakText('No pude entender tu respuesta. Por favor, int茅ntalo de nuevo.', () => {\n          startListening();\n        });\n      }, 1000);\n    });\n    try {\n      const started = await audioService.start();\n      if (started) {\n        setIsListening(true);\n        setConversationState('listening');\n        setConversationMessage('Escuchando...');\n      } else {\n        setError('No se pudo iniciar el reconocimiento de voz');\n        setConversationState('idle');\n      }\n    } catch (error) {\n      setError(`Error al iniciar reconocimiento: ${error.message || 'Error desconocido'}`);\n      setConversationState('idle');\n    }\n  };\n\n  // Manejar la respuesta por voz\n  const handleVoiceResponse = response => {\n    if (!response || response.trim() === '') {\n      // Si no hay respuesta, pedir que repita\n      speakText('No he escuchado ninguna respuesta. Por favor, intenta de nuevo.', () => {\n        startListening();\n      });\n      return;\n    }\n\n    // Guardar la respuesta actual\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = response;\n    setResponses(updatedResponses);\n\n    // Dar feedback al usuario\n    speakText(`He registrado tu respuesta: ${response}.`, () => {\n      // Pasar a la siguiente pregunta o finalizar\n      if (currentQuestionIndex < survey.questions.length - 1) {\n        setCurrentQuestionIndex(currentQuestionIndex + 1);\n        setCurrentResponse('');\n        // Hablar la siguiente pregunta despu茅s de un breve pausa\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 1000);\n      } else {\n        // Si es la 煤ltima pregunta, mostrar confirmaci贸n\n        setShowConfirmation(true);\n        speakText('Hemos terminado todas las preguntas. Ahora te mostrar茅 un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    });\n  };\n\n  // Leer el resumen de confirmaci贸n\n  const speakConfirmationSummary = () => {\n    if (!voiceEnabled || !showConfirmation) return;\n    let summaryText = 'Resumen de tus respuestas: ';\n    survey.questions.forEach((question, index) => {\n      summaryText += `Pregunta ${index + 1}: ${question.text}. Tu respuesta: ${responses[index] || \"Sin respuesta\"}. `;\n    });\n    summaryText += '驴Deseas enviar estas respuestas o volver para revisar alguna?';\n    speakText(summaryText, () => {\n      // Escuchar confirmaci贸n del usuario\n      listenForConfirmation();\n    });\n  };\n\n  // Escuchar la confirmaci贸n del usuario\n  const listenForConfirmation = () => {\n    if (!voiceEnabled) return;\n    audioService.init('es-ES');\n    audioService.onResult((transcript, isFinal) => {\n      // Mostrar lo que est谩 diciendo el usuario\n      setCurrentResponse(transcript);\n    });\n    audioService.onEnd(finalTranscript => {\n      setIsListening(false);\n\n      // Analizar respuesta para determinar si es confirmaci贸n o no\n      const lowerResponse = finalTranscript.toLowerCase();\n      if (lowerResponse.includes('s铆') || lowerResponse.includes('si') || lowerResponse.includes('confirmar') || lowerResponse.includes('enviar') || lowerResponse.includes('aceptar') || lowerResponse.includes('est谩 bien')) {\n        // Confirmado - enviar respuestas\n        speakText('Perfecto, enviando tus respuestas.', () => {\n          handleSubmit();\n        });\n      } else if (lowerResponse.includes('no') || lowerResponse.includes('volver') || lowerResponse.includes('revisar') || lowerResponse.includes('regresar')) {\n        // Volver a revisar\n        setShowConfirmation(false);\n        speakText('De acuerdo, volvamos a revisar las preguntas. Puedes navegar entre ellas usando los botones de anterior y siguiente.', null);\n      } else {\n        // Respuesta no clara\n        speakText('No he entendido si deseas confirmar o revisar. Por favor, dime \"confirmar\" para enviar las respuestas o \"revisar\" para volver a las preguntas.', () => {\n          listenForConfirmation();\n        });\n      }\n    });\n    audioService.onError(() => {\n      setIsListening(false);\n      speakText('Hubo un error al escuchar tu confirmaci贸n. Por favor, usa los botones en pantalla para confirmar o volver.', null);\n    });\n    audioService.start();\n    setIsListening(true);\n    setConversationState('listening');\n    setConversationMessage('Esperando confirmaci贸n...');\n  };\n\n  // Manejar el cambio de respuesta manual\n  const handleResponseChange = e => {\n    setCurrentResponse(e.target.value);\n  };\n\n  // Guardar la respuesta actual y avanzar a la siguiente pregunta manualmente\n  const handleNextQuestion = () => {\n    // Cancelar cualquier s铆ntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = currentResponse;\n    setResponses(updatedResponses);\n    if (currentQuestionIndex < survey.questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setCurrentResponse('');\n\n      // Si est谩 habilitada la voz, hablar la siguiente pregunta\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    } else {\n      setShowConfirmation(true);\n      if (voiceEnabled) {\n        speakText('Hemos terminado todas las preguntas. Ahora te mostrar茅 un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    }\n  };\n\n  // Volver a la pregunta anterior manualmente\n  const handlePreviousQuestion = () => {\n    // Cancelar cualquier s铆ntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n      setCurrentResponse(responses[currentQuestionIndex - 1]);\n\n      // Si est谩 habilitada la voz, hablar la pregunta anterior\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    }\n  };\n\n  // Enviar todas las respuestas\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    try {\n      // Preparar objeto de respuesta\n      const responseData = {\n        surveyId: survey._id,\n        responses: survey.questions.map((question, index) => ({\n          questionId: question._id,\n          questionText: question.text,\n          responseText: responses[index] || '',\n          questionType: question.type\n        }))\n      };\n\n      // Enviar respuesta a la API\n      await ResponseService.submitResponse(responseData);\n\n      // Mensaje de despedida\n      if (voiceEnabled) {\n        speakText(survey.farewell || '隆Gracias por completar la encuesta!', () => {\n          // Redirigir a p谩gina de agradecimiento\n          navigate(`/thank-you`, {\n            state: {\n              message: survey.farewell || '隆Gracias por completar la encuesta!'\n            }\n          });\n        });\n      } else {\n        // Redirigir a p谩gina de agradecimiento sin hablar\n        navigate(`/thank-you`, {\n          state: {\n            message: survey.farewell || '隆Gracias por completar la encuesta!'\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error al enviar respuestas:', error);\n      setError('Ocurri贸 un error al enviar tus respuestas. Por favor, intenta nuevamente.');\n      setIsSubmitting(false);\n      if (voiceEnabled) {\n        speakText('Ha ocurrido un error al enviar tus respuestas. Por favor, intenta nuevamente.', null);\n      }\n    }\n  };\n\n  // Iniciar reconocimiento de voz manual\n  const startVoiceRecognition = () => {\n    if (isListening) return;\n\n    // Cancelar cualquier s铆ntesis en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    startListening();\n  };\n\n  // Detener reconocimiento de voz manual\n  const stopVoiceRecognition = () => {\n    audioService.stop();\n    setIsListening(false);\n    setConversationState('idle');\n  };\n\n  // Alternar el uso de voz\n  const toggleVoice = () => {\n    // Cancelar cualquier s铆ntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    const newVoiceEnabled = !voiceEnabled;\n    setVoiceEnabled(newVoiceEnabled);\n    if (newVoiceEnabled && !conversationActive.current) {\n      // Si se activa la voz, iniciar conversaci贸n\n      conversationActive.current = false; // Reset para que startConversation funcione\n      startConversation();\n    }\n  };\n\n  // Renderizar pantalla de carga\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(LoadingSpinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 535,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Renderizar mensaje de error\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(ErrorMessage, {\n      message: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 540,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Si no hay encuesta\n  if (!survey) {\n    return /*#__PURE__*/_jsxDEV(ErrorMessage, {\n      message: \"No se encontr\\xF3 la encuesta solicitada.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 545,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Obtener la pregunta actual\n  const currentQuestion = survey.questions[currentQuestionIndex];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-end mb-2\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleVoice,\n        className: `px-3 py-1 rounded text-sm ${voiceEnabled ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-700'}`,\n        children: voiceEnabled ? ' Voz Activada' : ' Voz Desactivada'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 555,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 554,\n      columnNumber: 7\n    }, this), showPermissionDialog && micPermission === 'unknown' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-lg shadow-xl p-6 max-w-md mx-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-4 text-center\",\n          children: \"Permiso para usar el micr\\xF3fono\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 567,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mb-4\",\n          children: \"Esta encuesta utiliza reconocimiento de voz para una experiencia m\\xE1s natural. Para continuar, necesitamos tu permiso para acceder al micr\\xF3fono.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 568,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col gap-3 mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: requestMicrophonePermission,\n            className: \"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              className: \"h-5 w-5\",\n              viewBox: \"0 0 20 20\",\n              fill: \"currentColor\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                fillRule: \"evenodd\",\n                d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                clipRule: \"evenodd\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 578,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 577,\n              columnNumber: 17\n            }, this), \"Permitir micr\\xF3fono\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 573,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setShowPermissionDialog(false);\n              setVoiceEnabled(false);\n              setMicPermission('denied');\n            },\n            className: \"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300\",\n            children: \"Continuar sin voz\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 582,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 572,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 566,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 565,\n      columnNumber: 9\n    }, this), voiceEnabled && conversationState !== 'idle' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `mb-4 p-3 rounded-lg shadow-sm text-center ${conversationState === 'speaking' ? 'bg-blue-100 text-blue-700' : conversationState === 'listening' ? 'bg-green-100 text-green-700' : conversationState === 'requesting_permission' ? 'bg-purple-100 text-purple-700' : conversationState === 'permission_denied' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"font-semibold flex items-center justify-center gap-2\",\n        children: [conversationState === 'speaking' && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"inline-flex justify-center items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"h-2 w-2 bg-blue-600 rounded-full animate-ping mr-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"h-2 w-2 bg-blue-600 rounded-full animate-ping mx-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 610,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"h-2 w-2 bg-blue-600 rounded-full animate-ping ml-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 611,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 608,\n          columnNumber: 15\n        }, this), conversationState === 'listening' && /*#__PURE__*/_jsxDEV(\"svg\", {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          className: \"h-5 w-5 animate-pulse\",\n          viewBox: \"0 0 20 20\",\n          fill: \"currentColor\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            fillRule: \"evenodd\",\n            d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n            clipRule: \"evenodd\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 616,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 615,\n          columnNumber: 15\n        }, this), conversationMessage]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 11\n      }, this), isListening && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-sm mt-2 text-green-700\",\n        children: \"Escuch\\xE1ndote... habla claramente cuando escuches el tono.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 622,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 599,\n      columnNumber: 9\n    }, this), micPermission === 'denied' && voiceEnabled && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-4 p-3 rounded-lg bg-red-50 border border-red-200\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-red-700 flex items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          className: \"h-5 w-5 mr-2\",\n          viewBox: \"0 0 20 20\",\n          fill: \"currentColor\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            fillRule: \"evenodd\",\n            d: \"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\",\n            clipRule: \"evenodd\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 632,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 631,\n          columnNumber: 13\n        }, this), \"Se necesita acceso al micr\\xF3fono para usar la funcionalidad de voz.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 630,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-2 flex justify-end\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: requestMicrophonePermission,\n          className: \"text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700\",\n          children: \"Reintentar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 637,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setVoiceEnabled(false),\n          className: \"text-sm px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 ml-2\",\n          children: \"Continuar sin voz\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 643,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 636,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 629,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-8 text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-3xl font-bold mb-2\",\n        children: survey.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 655,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600\",\n        children: survey.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 656,\n        columnNumber: 9\n      }, this), currentQuestionIndex === 0 && survey.welcomeMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-4 p-4 bg-blue-50 rounded-lg\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: survey.welcomeMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 658,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 654,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full bg-gray-200 rounded-full h-2.5\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-blue-600 h-2.5 rounded-full\",\n          style: {\n            width: `${(currentQuestionIndex + 1) / survey.questions.length * 100}%`\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 667,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 666,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-right text-sm mt-1\",\n        children: [\"Pregunta \", currentQuestionIndex + 1, \" de \", survey.questions.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 672,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 665,\n      columnNumber: 7\n    }, this), showConfirmation ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-lg shadow-lg p-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold mb-4\",\n        children: \"Confirmar env\\xEDo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 680,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mb-4\",\n        children: \"\\xBFEst\\xE1s seguro de que deseas enviar tus respuestas?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 681,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"font-bold mb-2\",\n          children: \"Resumen de respuestas:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 684,\n          columnNumber: 13\n        }, this), survey.questions.map((question, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"font-medium\",\n            children: [index + 1, \". \", question.text]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 687,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-gray-700 pl-4\",\n            children: responses[index] || \"(Sin respuesta)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 688,\n            columnNumber: 17\n          }, this)]\n        }, question._id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 686,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 683,\n        columnNumber: 11\n      }, this), isListening && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-green-100 p-3 rounded mb-4 animate-pulse\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-center text-green-800\",\n          children: \"\\uD83C\\uDFA4 Di \\\"confirmar\\\" para enviar o \\\"revisar\\\" para volver\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 695,\n          columnNumber: 15\n        }, this), currentResponse && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm italic text-center mt-1\",\n          children: [\"\\\"\", currentResponse, \"\\\"\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 699,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 694,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            setShowConfirmation(false);\n            if (voiceEnabled) {\n              speakText('Volvamos a revisar las preguntas.', null);\n            }\n          },\n          className: \"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300\",\n          disabled: isSubmitting,\n          children: \"Volver\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 705,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSubmit,\n          className: \"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\",\n          disabled: isSubmitting,\n          children: isSubmitting ? 'Enviando...' : 'Confirmar env铆o'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 717,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 704,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 679,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-lg shadow-lg p-6 mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-4\",\n          children: currentQuestion.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 729,\n          columnNumber: 13\n        }, this), currentQuestion.type === 'multiple_choice' && currentQuestion.options && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-600 mb-2\",\n            children: \"Opciones:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 734,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"list-disc pl-5\",\n            children: currentQuestion.options.map((option, idx) => /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"mb-1\",\n              children: option\n            }, idx, false, {\n              fileName: _jsxFileName,\n              lineNumber: 737,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 735,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 733,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"block text-sm font-medium text-gray-700 mb-1\",\n            children: \"Tu respuesta:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 745,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: currentResponse,\n            onChange: handleResponseChange,\n            className: \"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",\n            rows: \"3\",\n            placeholder: \"Escribe tu respuesta...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 748,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center mt-2\",\n            children: [voiceEnabled && micPermission === 'granted' && !isListening ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: startVoiceRecognition,\n              className: \"flex items-center px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 764,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 763,\n                columnNumber: 21\n              }, this), \"Responder por voz\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 759,\n              columnNumber: 19\n            }, this) : voiceEnabled && micPermission === 'granted' && isListening ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: stopVoiceRecognition,\n              className: \"flex items-center px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 shadow-sm animate-pulse\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 774,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 773,\n                columnNumber: 21\n              }, this), \"Detener grabaci\\xF3n\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 769,\n              columnNumber: 19\n            }, this) : voiceEnabled && micPermission === 'unknown' ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: requestMicrophonePermission,\n              className: \"flex items-center px-3 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 784,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 783,\n                columnNumber: 21\n              }, this), \"Permitir micr\\xF3fono\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 779,\n              columnNumber: 19\n            }, this) : voiceEnabled && micPermission === 'denied' ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: requestMicrophonePermission,\n              className: \"flex items-center px-3 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 shadow-sm border border-red-300\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 794,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 793,\n                columnNumber: 21\n              }, this), \"Micr\\xF3fono bloqueado\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 789,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                setVoiceEnabled(true);\n                requestMicrophonePermission();\n              },\n              className: \"flex items-center px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 807,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 806,\n                columnNumber: 21\n              }, this), \"Activar modo voz\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 799,\n              columnNumber: 19\n            }, this), isListening && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"ml-2 text-green-600 flex items-center animate-pulse\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"w-2 h-2 bg-green-600 rounded-full mr-1 animate-ping\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 815,\n                columnNumber: 21\n              }, this), \"Escuchando...\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 814,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 757,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 744,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 728,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handlePreviousQuestion,\n          disabled: currentQuestionIndex === 0,\n          className: `px-4 py-2 rounded ${currentQuestionIndex === 0 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`,\n          children: \"Anterior\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 825,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleNextQuestion,\n          className: \"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\",\n          children: currentQuestionIndex < survey.questions.length - 1 ? 'Siguiente' : 'Finalizar'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 837,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 824,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 552,\n    columnNumber: 5\n  }, this);\n};\n_s(TakeSurvey, \"/Q0DyABdRa+LNpr9Mnmxkw4ETzI=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = TakeSurvey;\nexport default TakeSurvey;\nvar _c;\n$RefreshReg$(_c, \"TakeSurvey\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","SurveyService","ResponseService","LoadingSpinner","ErrorMessage","audioService","nlpService","jsxDEV","_jsxDEV","Fragment","_Fragment","TakeSurvey","_s","surveyId","navigate","conversationActive","speakTimeoutRef","survey","setSurvey","loading","setLoading","error","setError","currentQuestionIndex","setCurrentQuestionIndex","responses","setResponses","isSubmitting","setIsSubmitting","showConfirmation","setShowConfirmation","currentResponse","setCurrentResponse","isListening","setIsListening","voiceEnabled","setVoiceEnabled","conversationState","setConversationState","conversationMessage","setConversationMessage","micPermission","setMicPermission","recognizedText","setRecognizedText","status","setStatus","showPermissionDialog","setShowPermissionDialog","requestMicrophonePermission","permissionGranted","setTimeout","startConversation","console","fetchSurvey","data","getPublicSurvey","log","Array","questions","length","fill","initSpeechSystem","onPermissionChange","granted","errorMsg","current","clearTimeout","stop","window","speechSynthesis","cancel","welcomeMessage","speakText","speakCurrentQuestion","text","onEndCallback","substring","estimatedSpeakTime","Math","max","currentQuestion","questionText","type","options","map","option","idx","join","startListening","isSupportedByBrowser","init","onResult","transcript","isFinal","onEnd","finalTranscript","handleVoiceResponse","onError","errorMessage","started","start","message","response","trim","updatedResponses","speakConfirmationSummary","summaryText","forEach","question","index","listenForConfirmation","lowerResponse","toLowerCase","includes","handleSubmit","handleResponseChange","e","target","value","handleNextQuestion","handlePreviousQuestion","responseData","_id","questionId","responseText","questionType","submitResponse","farewell","state","startVoiceRecognition","stopVoiceRecognition","toggleVoice","newVoiceEnabled","fileName","_jsxFileName","lineNumber","columnNumber","className","children","onClick","xmlns","viewBox","fillRule","d","clipRule","title","description","style","width","disabled","onChange","rows","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/josep/Documents/Sistema de Encuestas por Voz/client/src/pages/TakeSurvey.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { SurveyService, ResponseService } from '../services/apiService';\n\n// Componentes\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport ErrorMessage from '../components/ErrorMessage';\nimport audioService from '../services/audioService';\n// Importar servicio de procesamiento de lenguaje natural\nimport * as nlpService from '../services/nlpService';\n\nconst TakeSurvey = () => {\n  const { surveyId } = useParams();\n  const navigate = useNavigate();\n  \n  // Referencias para controlar el flujo de la conversaci贸n\n  const conversationActive = useRef(false);\n  const speakTimeoutRef = useRef(null);\n  \n  // Estados\n  const [survey, setSurvey] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [responses, setResponses] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [currentResponse, setCurrentResponse] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const [voiceEnabled, setVoiceEnabled] = useState(true);\n  const [conversationState, setConversationState] = useState('idle'); // idle, speaking, listening, processing\n  const [conversationMessage, setConversationMessage] = useState('');\n  const [micPermission, setMicPermission] = useState('unknown'); // 'unknown', 'granted', 'denied'\n  const [recognizedText, setRecognizedText] = useState('');\n  const [status, setStatus] = useState('');\n  const [showPermissionDialog, setShowPermissionDialog] = useState(false);\n  \n  // Verificar permiso del micr贸fono\n  const requestMicrophonePermission = async () => {\n    setConversationState('requesting_permission');\n    setConversationMessage('Solicitando permiso para el micr贸fono...');\n    \n    try {\n      const permissionGranted = await audioService.requestMicrophonePermission();\n      \n      if (permissionGranted) {\n        setMicPermission('granted');\n        setShowPermissionDialog(false);\n        setConversationMessage('Permiso concedido. Iniciando encuesta por voz...');\n        \n        // Peque帽o retraso para iniciar la conversaci贸n\n        setTimeout(() => {\n          startConversation();\n        }, 1000);\n      } else {\n        setMicPermission('denied');\n        setConversationState('permission_denied');\n        setConversationMessage('Se necesita acceso al micr贸fono para usar la funci贸n de voz');\n      }\n    } catch (error) {\n      console.error('Error al solicitar permiso:', error);\n      setMicPermission('denied');\n      setConversationState('error');\n      setConversationMessage('Error al solicitar permiso del micr贸fono');\n    }\n  };\n\n  // Cargar la encuesta\n  useEffect(() => {\n    const fetchSurvey = async () => {\n      try {\n        const data = await SurveyService.getPublicSurvey(surveyId);\n        console.log('Encuesta cargada:', data);\n        setSurvey(data);\n        // Inicializar respuestas vac铆as\n        setResponses(new Array(data.questions.length).fill(''));\n      } catch (error) {\n        console.error('Error al cargar la encuesta:', error);\n        setError('No se pudo cargar la encuesta. Verifique que el ID sea correcto y que la encuesta est茅 activa.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchSurvey();\n    \n    // Inicializar sistema de voz\n    audioService.initSpeechSystem();\n    \n    // Configurar el callback para cambios en el permiso del micr贸fono\n    audioService.onPermissionChange((granted, errorMsg) => {\n      setMicPermission(granted ? 'granted' : 'denied');\n      if (!granted && errorMsg) {\n        setConversationMessage(`Error de permiso: ${errorMsg}`);\n        setConversationState('permission_denied');\n      }\n    });\n    \n    return () => {\n      // Detener cualquier s铆ntesis y reconocimiento al desmontar\n      if (speakTimeoutRef.current) {\n        clearTimeout(speakTimeoutRef.current);\n      }\n      audioService.stop();\n      conversationActive.current = false;\n      \n      if (window.speechSynthesis) {\n        window.speechSynthesis.cancel();\n      }\n    };\n  }, [surveyId]);\n  \n  // Iniciar la conversaci贸n una vez que la encuesta est茅 cargada\n  useEffect(() => {\n    if (survey && voiceEnabled && !conversationActive.current) {\n      // Primero verificar permiso de micr贸fono\n      if (micPermission === 'granted') {\n        startConversation();\n      } else if (micPermission === 'unknown') {\n        // Mostrar di谩logo de permiso\n        setShowPermissionDialog(true);\n      }\n    }\n  }, [survey, voiceEnabled, micPermission]);\n  \n  // Funci贸n para iniciar la conversaci贸n\n  const startConversation = () => {\n    if (!voiceEnabled || !survey) return;\n    \n    conversationActive.current = true;\n    \n    // Dar un mensaje de bienvenida\n    if (survey.welcomeMessage) {\n      speakText(survey.welcomeMessage, () => {\n        // Despu茅s de la bienvenida, preguntar la primera pregunta\n        speakCurrentQuestion();\n      });\n    } else {\n      // Si no hay mensaje de bienvenida, ir directamente a la primera pregunta\n      speakCurrentQuestion();\n    }\n  };\n  \n  // Funci贸n para hablar el texto usando el servicio de audio con pausas naturales\n  const speakText = (text, onEndCallback) => {\n    if (!voiceEnabled) {\n      if (onEndCallback) onEndCallback();\n      return;\n    }\n    \n    // Cancela cualquier s铆ntesis en curso y limpia los timeouts anteriores\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    \n    if (speakTimeoutRef.current) {\n      clearTimeout(speakTimeoutRef.current);\n      speakTimeoutRef.current = null;\n    }\n    \n    // Pausa breve antes de comenzar a hablar para evitar interrupciones\n    speakTimeoutRef.current = setTimeout(() => {\n      setConversationState('speaking');\n      setConversationMessage('Hablando: ' + text.substring(0, 30) + (text.length > 30 ? '...' : ''));\n      \n      // Calcular un tiempo estimado basado en la longitud del texto (aproximadamente 80ms por car谩cter)\n      const estimatedSpeakTime = Math.max(3000, text.length * 80);\n      \n      audioService.speakText(\n        text,\n        () => {\n          console.log('Hablando:', text);\n        },\n        () => {\n          console.log('Termin贸 de hablar');\n          setConversationState('idle');\n          \n          // Esperar un tiempo m谩s largo despu茅s de hablar para una conversaci贸n m谩s natural\n          if (onEndCallback) {\n            speakTimeoutRef.current = setTimeout(onEndCallback, 1000);\n          }\n        },\n        (error) => {\n          console.error('Error al hablar:', error);\n          setConversationState('idle');\n          \n          // En caso de error, esperar un poco antes de continuar\n          if (onEndCallback) {\n            speakTimeoutRef.current = setTimeout(onEndCallback, 1000);\n          }\n        }\n      );\n    }, 500); // Esperar 500ms antes de iniciar una nueva s铆ntesis\n  };\n  \n  // Funci贸n para hablar la pregunta actual\n  const speakCurrentQuestion = () => {\n    if (!survey || !voiceEnabled) return;\n    \n    const currentQuestion = survey.questions[currentQuestionIndex];\n    if (!currentQuestion) return;\n    \n    let questionText = `Pregunta ${currentQuestionIndex + 1}: ${currentQuestion.text}`;\n    \n    // Agregar informaci贸n sobre opciones si es pregunta de opci贸n m煤ltiple\n    if (currentQuestion.type === 'multiple_choice' && currentQuestion.options) {\n      questionText += '. Las opciones son: ';\n      questionText += currentQuestion.options.map((option, idx) => \n        `Opci贸n ${idx + 1}: ${option}`\n      ).join(', ');\n    }\n    \n    speakText(questionText, () => {\n      // Despu茅s de hablar la pregunta, iniciar el reconocimiento de voz\n      startListening();\n    });\n  };\n  \n  // Funci贸n para iniciar la escucha de la respuesta del usuario\n  const startListening = async () => {\n    if (!voiceEnabled) return;\n    \n    if (!audioService.isSupportedByBrowser()) {\n      setError('Tu navegador no soporta reconocimiento de voz');\n      return;\n    }\n    \n    if (micPermission !== 'granted') {\n      await requestMicrophonePermission();\n      return;\n    }\n    \n    audioService.init('es-ES');\n    \n    setRecognizedText('');\n    \n    audioService.onResult((transcript, isFinal) => {\n      setCurrentResponse(transcript);\n      setStatus(isFinal ? 'Procesando...' : 'Escuchando...');\n    });\n    \n    audioService.onEnd((finalTranscript) => {\n      setIsListening(false);\n      setConversationState('processing');\n      setConversationMessage('Procesando respuesta...');\n      \n      // Guardar la respuesta y continuar la conversaci贸n\n      handleVoiceResponse(finalTranscript);\n    });\n    \n    audioService.onError((errorMessage) => {\n      console.error('Error de reconocimiento:', errorMessage);\n      setError(`Error de reconocimiento: ${errorMessage}`);\n      setIsListening(false);\n      setConversationState('idle');\n      \n      // Reintentar la escucha despu茅s de un error\n      speakTimeoutRef.current = setTimeout(() => {\n        speakText('No pude entender tu respuesta. Por favor, int茅ntalo de nuevo.', () => {\n          startListening();\n        });\n      }, 1000);\n    });\n    \n    try {\n      const started = await audioService.start();\n      if (started) {\n        setIsListening(true);\n        setConversationState('listening');\n        setConversationMessage('Escuchando...');\n      } else {\n        setError('No se pudo iniciar el reconocimiento de voz');\n        setConversationState('idle');\n      }\n    } catch (error) {\n      setError(`Error al iniciar reconocimiento: ${error.message || 'Error desconocido'}`);\n      setConversationState('idle');\n    }\n  };\n  \n  // Manejar la respuesta por voz\n  const handleVoiceResponse = (response) => {\n    if (!response || response.trim() === '') {\n      // Si no hay respuesta, pedir que repita\n      speakText('No he escuchado ninguna respuesta. Por favor, intenta de nuevo.', () => {\n        startListening();\n      });\n      return;\n    }\n    \n    // Guardar la respuesta actual\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = response;\n    setResponses(updatedResponses);\n    \n    // Dar feedback al usuario\n    speakText(`He registrado tu respuesta: ${response}.`, () => {\n      // Pasar a la siguiente pregunta o finalizar\n      if (currentQuestionIndex < survey.questions.length - 1) {\n        setCurrentQuestionIndex(currentQuestionIndex + 1);\n        setCurrentResponse('');\n        // Hablar la siguiente pregunta despu茅s de un breve pausa\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 1000);\n      } else {\n        // Si es la 煤ltima pregunta, mostrar confirmaci贸n\n        setShowConfirmation(true);\n        speakText('Hemos terminado todas las preguntas. Ahora te mostrar茅 un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    });\n  };\n  \n  // Leer el resumen de confirmaci贸n\n  const speakConfirmationSummary = () => {\n    if (!voiceEnabled || !showConfirmation) return;\n    \n    let summaryText = 'Resumen de tus respuestas: ';\n    \n    survey.questions.forEach((question, index) => {\n      summaryText += `Pregunta ${index + 1}: ${question.text}. Tu respuesta: ${responses[index] || \"Sin respuesta\"}. `;\n    });\n    \n    summaryText += '驴Deseas enviar estas respuestas o volver para revisar alguna?';\n    \n    speakText(summaryText, () => {\n      // Escuchar confirmaci贸n del usuario\n      listenForConfirmation();\n    });\n  };\n  \n  // Escuchar la confirmaci贸n del usuario\n  const listenForConfirmation = () => {\n    if (!voiceEnabled) return;\n    \n    audioService.init('es-ES');\n    \n    audioService.onResult((transcript, isFinal) => {\n      // Mostrar lo que est谩 diciendo el usuario\n      setCurrentResponse(transcript);\n    });\n    \n    audioService.onEnd((finalTranscript) => {\n      setIsListening(false);\n      \n      // Analizar respuesta para determinar si es confirmaci贸n o no\n      const lowerResponse = finalTranscript.toLowerCase();\n      if (\n        lowerResponse.includes('s铆') || \n        lowerResponse.includes('si') || \n        lowerResponse.includes('confirmar') || \n        lowerResponse.includes('enviar') ||\n        lowerResponse.includes('aceptar') ||\n        lowerResponse.includes('est谩 bien')\n      ) {\n        // Confirmado - enviar respuestas\n        speakText('Perfecto, enviando tus respuestas.', () => {\n          handleSubmit();\n        });\n      } else if (\n        lowerResponse.includes('no') || \n        lowerResponse.includes('volver') || \n        lowerResponse.includes('revisar') ||\n        lowerResponse.includes('regresar')\n      ) {\n        // Volver a revisar\n        setShowConfirmation(false);\n        speakText('De acuerdo, volvamos a revisar las preguntas. Puedes navegar entre ellas usando los botones de anterior y siguiente.', null);\n      } else {\n        // Respuesta no clara\n        speakText('No he entendido si deseas confirmar o revisar. Por favor, dime \"confirmar\" para enviar las respuestas o \"revisar\" para volver a las preguntas.', () => {\n          listenForConfirmation();\n        });\n      }\n    });\n    \n    audioService.onError(() => {\n      setIsListening(false);\n      speakText('Hubo un error al escuchar tu confirmaci贸n. Por favor, usa los botones en pantalla para confirmar o volver.', null);\n    });\n    \n    audioService.start();\n    setIsListening(true);\n    setConversationState('listening');\n    setConversationMessage('Esperando confirmaci贸n...');\n  };\n  \n  // Manejar el cambio de respuesta manual\n  const handleResponseChange = (e) => {\n    setCurrentResponse(e.target.value);\n  };\n  \n  // Guardar la respuesta actual y avanzar a la siguiente pregunta manualmente\n  const handleNextQuestion = () => {\n    // Cancelar cualquier s铆ntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    \n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = currentResponse;\n    setResponses(updatedResponses);\n    \n    if (currentQuestionIndex < survey.questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setCurrentResponse('');\n      \n      // Si est谩 habilitada la voz, hablar la siguiente pregunta\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    } else {\n      setShowConfirmation(true);\n      if (voiceEnabled) {\n        speakText('Hemos terminado todas las preguntas. Ahora te mostrar茅 un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    }\n  };\n  \n  // Volver a la pregunta anterior manualmente\n  const handlePreviousQuestion = () => {\n    // Cancelar cualquier s铆ntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    \n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n      setCurrentResponse(responses[currentQuestionIndex - 1]);\n      \n      // Si est谩 habilitada la voz, hablar la pregunta anterior\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    }\n  };\n  \n  // Enviar todas las respuestas\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    \n    try {\n      // Preparar objeto de respuesta\n      const responseData = {\n        surveyId: survey._id,\n        responses: survey.questions.map((question, index) => ({\n          questionId: question._id,\n          questionText: question.text,\n          responseText: responses[index] || '',\n          questionType: question.type\n        }))\n      };\n      \n      // Enviar respuesta a la API\n      await ResponseService.submitResponse(responseData);\n      \n      // Mensaje de despedida\n      if (voiceEnabled) {\n        speakText(survey.farewell || '隆Gracias por completar la encuesta!', () => {\n          // Redirigir a p谩gina de agradecimiento\n          navigate(`/thank-you`, { \n            state: { \n              message: survey.farewell || '隆Gracias por completar la encuesta!' \n            } \n          });\n        });\n      } else {\n        // Redirigir a p谩gina de agradecimiento sin hablar\n        navigate(`/thank-you`, { \n          state: { \n            message: survey.farewell || '隆Gracias por completar la encuesta!' \n          } \n        });\n      }\n    } catch (error) {\n      console.error('Error al enviar respuestas:', error);\n      setError('Ocurri贸 un error al enviar tus respuestas. Por favor, intenta nuevamente.');\n      setIsSubmitting(false);\n      \n      if (voiceEnabled) {\n        speakText('Ha ocurrido un error al enviar tus respuestas. Por favor, intenta nuevamente.', null);\n      }\n    }\n  };\n  \n  // Iniciar reconocimiento de voz manual\n  const startVoiceRecognition = () => {\n    if (isListening) return;\n    \n    // Cancelar cualquier s铆ntesis en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    \n    startListening();\n  };\n  \n  // Detener reconocimiento de voz manual\n  const stopVoiceRecognition = () => {\n    audioService.stop();\n    setIsListening(false);\n    setConversationState('idle');\n  };\n  \n  // Alternar el uso de voz\n  const toggleVoice = () => {\n    // Cancelar cualquier s铆ntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    \n    const newVoiceEnabled = !voiceEnabled;\n    setVoiceEnabled(newVoiceEnabled);\n    \n    if (newVoiceEnabled && !conversationActive.current) {\n      // Si se activa la voz, iniciar conversaci贸n\n      conversationActive.current = false; // Reset para que startConversation funcione\n      startConversation();\n    }\n  };\n  \n  // Renderizar pantalla de carga\n  if (loading) {\n    return <LoadingSpinner />;\n  }\n  \n  // Renderizar mensaje de error\n  if (error) {\n    return <ErrorMessage message={error} />;\n  }\n  \n  // Si no hay encuesta\n  if (!survey) {\n    return <ErrorMessage message=\"No se encontr贸 la encuesta solicitada.\" />;\n  }\n  \n  // Obtener la pregunta actual\n  const currentQuestion = survey.questions[currentQuestionIndex];\n  \n  return (\n    <div className=\"max-w-3xl mx-auto p-4\">\n      {/* Control de voz */}\n      <div className=\"flex justify-end mb-2\">\n        <button \n          onClick={toggleVoice} \n          className={`px-3 py-1 rounded text-sm ${voiceEnabled ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-700'}`}\n        >\n          {voiceEnabled ? ' Voz Activada' : ' Voz Desactivada'}\n        </button>\n      </div>\n      \n      {/* Di谩logo de permisos del micr贸fono */}\n      {showPermissionDialog && micPermission === 'unknown' && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl p-6 max-w-md mx-auto\">\n            <h2 className=\"text-xl font-bold mb-4 text-center\">Permiso para usar el micr贸fono</h2>\n            <p className=\"mb-4\">\n              Esta encuesta utiliza reconocimiento de voz para una experiencia m谩s natural. \n              Para continuar, necesitamos tu permiso para acceder al micr贸fono.\n            </p>\n            <div className=\"flex flex-col gap-3 mt-6\">\n              <button\n                onClick={requestMicrophonePermission}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center gap-2\"\n              >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                  <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                </svg>\n                Permitir micr贸fono\n              </button>\n              <button\n                onClick={() => {\n                  setShowPermissionDialog(false);\n                  setVoiceEnabled(false);\n                  setMicPermission('denied');\n                }}\n                className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300\"\n              >\n                Continuar sin voz\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Estado de la conversaci贸n */}\n      {voiceEnabled && conversationState !== 'idle' && (\n        <div className={`mb-4 p-3 rounded-lg shadow-sm text-center ${\n          conversationState === 'speaking' ? 'bg-blue-100 text-blue-700' : \n          conversationState === 'listening' ? 'bg-green-100 text-green-700' : \n          conversationState === 'requesting_permission' ? 'bg-purple-100 text-purple-700' :\n          conversationState === 'permission_denied' ? 'bg-red-100 text-red-700' :\n          'bg-yellow-100 text-yellow-700'\n        }`}>\n          <p className=\"font-semibold flex items-center justify-center gap-2\">\n            {conversationState === 'speaking' && (\n              <span className=\"inline-flex justify-center items-center\">\n                <span className=\"h-2 w-2 bg-blue-600 rounded-full animate-ping mr-1\"></span>\n                <span className=\"h-2 w-2 bg-blue-600 rounded-full animate-ping mx-1\"></span>\n                <span className=\"h-2 w-2 bg-blue-600 rounded-full animate-ping ml-1\"></span>\n              </span>\n            )}\n            {conversationState === 'listening' && (\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 animate-pulse\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n              </svg>\n            )}\n            {conversationMessage}\n          </p>\n          {isListening && (\n            <p className=\"text-sm mt-2 text-green-700\">Escuch谩ndote... habla claramente cuando escuches el tono.</p>\n          )}\n        </div>\n      )}\n      \n      {/* Mensaje de error de permisos */}\n      {micPermission === 'denied' && voiceEnabled && (\n        <div className=\"mb-4 p-3 rounded-lg bg-red-50 border border-red-200\">\n          <p className=\"text-red-700 flex items-center\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n            </svg>\n            Se necesita acceso al micr贸fono para usar la funcionalidad de voz.\n          </p>\n          <div className=\"mt-2 flex justify-end\">\n            <button \n              onClick={requestMicrophonePermission}\n              className=\"text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700\"\n            >\n              Reintentar\n            </button>\n            <button \n              onClick={() => setVoiceEnabled(false)}\n              className=\"text-sm px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 ml-2\"\n            >\n              Continuar sin voz\n            </button>\n          </div>\n        </div>\n      )}\n      \n      {/* Encabezado de la encuesta */}\n      <div className=\"mb-8 text-center\">\n        <h1 className=\"text-3xl font-bold mb-2\">{survey.title}</h1>\n        <p className=\"text-gray-600\">{survey.description}</p>\n        {currentQuestionIndex === 0 && survey.welcomeMessage && (\n          <div className=\"mt-4 p-4 bg-blue-50 rounded-lg\">\n            <p>{survey.welcomeMessage}</p>\n          </div>\n        )}\n      </div>\n      \n      {/* Progreso */}\n      <div className=\"mb-6\">\n        <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\n          <div \n            className=\"bg-blue-600 h-2.5 rounded-full\" \n            style={{ width: `${((currentQuestionIndex + 1) / survey.questions.length) * 100}%` }}\n          ></div>\n        </div>\n        <p className=\"text-right text-sm mt-1\">\n          Pregunta {currentQuestionIndex + 1} de {survey.questions.length}\n        </p>\n      </div>\n      \n      {/* Pantalla de confirmaci贸n */}\n      {showConfirmation ? (\n        <div className=\"bg-white rounded-lg shadow-lg p-6\">\n          <h2 className=\"text-2xl font-bold mb-4\">Confirmar env铆o</h2>\n          <p className=\"mb-4\">驴Est谩s seguro de que deseas enviar tus respuestas?</p>\n          \n          <div className=\"mb-6\">\n            <h3 className=\"font-bold mb-2\">Resumen de respuestas:</h3>\n            {survey.questions.map((question, index) => (\n              <div key={question._id} className=\"mb-3\">\n                <p className=\"font-medium\">{index + 1}. {question.text}</p>\n                <p className=\"text-gray-700 pl-4\">{responses[index] || \"(Sin respuesta)\"}</p>\n              </div>\n            ))}\n          </div>\n          \n          {isListening && (\n            <div className=\"bg-green-100 p-3 rounded mb-4 animate-pulse\">\n              <p className=\"text-center text-green-800\">\n                 Di \"confirmar\" para enviar o \"revisar\" para volver\n              </p>\n              {currentResponse && (\n                <p className=\"text-sm italic text-center mt-1\">\"{currentResponse}\"</p>\n              )}\n            </div>\n          )}\n          \n          <div className=\"flex justify-between\">\n            <button\n              onClick={() => {\n                setShowConfirmation(false);\n                if (voiceEnabled) {\n                  speakText('Volvamos a revisar las preguntas.', null);\n                }\n              }}\n              className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300\"\n              disabled={isSubmitting}\n            >\n              Volver\n            </button>\n            <button\n              onClick={handleSubmit}\n              className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\"\n              disabled={isSubmitting}\n            >\n              {isSubmitting ? 'Enviando...' : 'Confirmar env铆o'}\n            </button>\n          </div>\n        </div>      ) : (\n        <>\n          {/* Pregunta actual */}\n          <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n            <h2 className=\"text-xl font-bold mb-4\">{currentQuestion.text}</h2>\n            \n            {/* Opciones para preguntas de tipo opci贸n */}\n            {currentQuestion.type === 'multiple_choice' && currentQuestion.options && (\n              <div className=\"mb-4\">\n                <p className=\"text-sm text-gray-600 mb-2\">Opciones:</p>\n                <ul className=\"list-disc pl-5\">\n                  {currentQuestion.options.map((option, idx) => (\n                    <li key={idx} className=\"mb-1\">{option}</li>\n                  ))}\n                </ul>\n              </div>\n            )}\n            \n            {/* rea de respuesta */}\n            <div className=\"mt-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Tu respuesta:\n              </label>\n              <textarea\n                value={currentResponse}\n                onChange={handleResponseChange}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                rows=\"3\"\n                placeholder=\"Escribe tu respuesta...\"\n              ></textarea>\n              \n              {/* Controles de reconocimiento de voz */}\n              <div className=\"flex items-center mt-2\">\n                {voiceEnabled && micPermission === 'granted' && !isListening ? (\n                  <button\n                    onClick={startVoiceRecognition}\n                    className=\"flex items-center px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 shadow-sm\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Responder por voz\n                  </button>\n                ) : voiceEnabled && micPermission === 'granted' && isListening ? (\n                  <button\n                    onClick={stopVoiceRecognition}\n                    className=\"flex items-center px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 shadow-sm animate-pulse\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Detener grabaci贸n\n                  </button>\n                ) : voiceEnabled && micPermission === 'unknown' ? (\n                  <button\n                    onClick={requestMicrophonePermission}\n                    className=\"flex items-center px-3 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 shadow-sm\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path d=\"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z\" />\n                    </svg>\n                    Permitir micr贸fono\n                  </button>\n                ) : voiceEnabled && micPermission === 'denied' ? (\n                  <button\n                    onClick={requestMicrophonePermission}\n                    className=\"flex items-center px-3 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 shadow-sm border border-red-300\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Micr贸fono bloqueado\n                  </button>\n                ) : (\n                  <button\n                    onClick={() => {\n                      setVoiceEnabled(true);\n                      requestMicrophonePermission();\n                    }}\n                    className=\"flex items-center px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 shadow-sm\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Activar modo voz\n                  </button>\n                )}\n                \n                {isListening && (\n                  <span className=\"ml-2 text-green-600 flex items-center animate-pulse\">\n                    <span className=\"w-2 h-2 bg-green-600 rounded-full mr-1 animate-ping\"></span>\n                    Escuchando...\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          {/* Botones de navegaci贸n */}\n          <div className=\"flex justify-between\">\n            <button\n              onClick={handlePreviousQuestion}\n              disabled={currentQuestionIndex === 0}\n              className={`px-4 py-2 rounded ${\n                currentQuestionIndex === 0\n                  ? 'bg-gray-200 text-gray-400 cursor-not-allowed'\n                  : 'bg-gray-200 text-gray-800 hover:bg-gray-300'\n              }`}\n            >\n              Anterior\n            </button>\n            \n            <button\n              onClick={handleNextQuestion}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n            >\n              {currentQuestionIndex < survey.questions.length - 1 ? 'Siguiente' : 'Finalizar'}\n            </button>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default TakeSurvey;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}