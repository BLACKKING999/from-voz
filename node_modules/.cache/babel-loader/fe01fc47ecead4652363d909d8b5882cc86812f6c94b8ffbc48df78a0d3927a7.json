{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\josep\\\\Documents\\\\Sistema de Encuestas por Voz\\\\client\\\\src\\\\pages\\\\TakeSurvey.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { isSpeechRecognitionSupported, isSpeechSynthesisSupported, listenForSpeech, speakText, processVoiceResponse, checkMicrophonePermission } from '../utils/voiceSurveyAPI';\nimport { SurveyService, ResponseService } from '../services/apiService';\nimport SimpleVoice from '../components/SimpleVoice';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst TakeSurvey = () => {\n  _s();\n  var _survey$questions2;\n  const {\n    surveyId\n  } = useParams();\n  const navigate = useNavigate();\n  const [survey, setSurvey] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [currentStep, setCurrentStep] = useState('welcome'); // welcome, name, questions, thanks\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [userName, setUserName] = useState('');\n  const [responses, setResponses] = useState([]);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [isListening, setIsListening] = useState(false);\n  const [transcript, setTranscript] = useState('');\n  const [errorMessage, setErrorMessage] = useState('');\n  const [browserSupported, setBrowserSupported] = useState(true);\n  const [microphonePermission, setMicrophonePermission] = useState(null);\n  const [showThankYouMessage, setShowThankYouMessage] = useState(false);\n\n  // Frases para mejorar la naturalidad de la conversación\n  const CONVERSATION_PHRASES = {\n    acknowledgments: ['Entendido.', 'Perfecto.', 'Muy bien.', 'Gracias por su respuesta.', 'He registrado su respuesta.'],\n    clarifications: ['No he entendido bien. ¿Podría repetirlo?', 'Disculpe, ¿podría decirlo de nuevo?', 'No pude entender su respuesta. Intentemos de nuevo.'],\n    transitions: ['Pasemos a la siguiente pregunta.', 'Continuamos con la siguiente pregunta.', 'Ahora, la siguiente pregunta.']\n  };\n\n  // Comprobar compatibilidad del navegador y permisos\n  useEffect(() => {\n    const checkCompatibility = async () => {\n      // Verificar si el navegador soporta reconocimiento de voz\n      const speechRecognitionSupported = isSpeechRecognitionSupported();\n      const speechSynthesisSupported = isSpeechSynthesisSupported();\n      if (!speechRecognitionSupported || !speechSynthesisSupported) {\n        setBrowserSupported(false);\n        setErrorMessage('Su navegador no soporta las tecnologías de voz necesarias para esta encuesta. Por favor, use Chrome, Edge o Safari.');\n        return;\n      }\n\n      // Verificar permisos de micrófono\n      const hasMicrophonePermission = await checkMicrophonePermission();\n      setMicrophonePermission(hasMicrophonePermission);\n      if (!hasMicrophonePermission) {\n        setErrorMessage('Necesitamos permiso para usar su micrófono. Por favor, permita el acceso cuando se le solicite.');\n      }\n    };\n    checkCompatibility();\n  }, []);\n\n  // Obtener datos de la encuesta\n  useEffect(() => {\n    const fetchSurvey = async () => {\n      try {\n        setLoading(true);\n        console.log(`Intentando cargar la encuesta con ID: ${surveyId}`);\n\n        // Usar el servicio centralizado para obtener la encuesta pública\n        const data = await SurveyService.getPublicSurvey(surveyId);\n        if (data) {\n          console.log('Encuesta cargada exitosamente:', data);\n          setSurvey(data);\n          // Inicializar array de respuestas\n          setResponses(data.questions.map(() => ({\n            value: '',\n            timestamp: null\n          })));\n        } else {\n          console.error('La respuesta no contiene datos');\n          setErrorMessage('La encuesta no contiene datos válidos.');\n        }\n        setLoading(false);\n      } catch (error) {\n        console.error('Error fetching survey:', error);\n\n        // Mensajes de error más específicos\n        if (error.response) {\n          // El servidor respondió con un código de error\n          if (error.response.status === 404) {\n            setErrorMessage('Encuesta no encontrada. El ID proporcionado no corresponde a ninguna encuesta existente.');\n          } else if (error.response.status === 403) {\n            setErrorMessage('Esta encuesta ya no está activa o no es pública.');\n          } else {\n            var _error$response$data;\n            setErrorMessage(`Error del servidor: ${((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Error desconocido'}`);\n          }\n        } else if (error.request) {\n          // La solicitud se hizo pero no se recibió respuesta\n          setErrorMessage('No se pudo conectar con el servidor. Verifica tu conexión a internet.');\n        } else {\n          // Error al configurar la solicitud\n          setErrorMessage('Error al crear la solicitud: ' + error.message);\n        }\n        setLoading(false);\n      }\n    };\n    if (surveyId) {\n      fetchSurvey();\n    }\n  }, [surveyId]);\n\n  // Efecto para iniciar la conversación cuando la encuesta se carga correctamente\n  useEffect(() => {\n    if (survey && browserSupported && microphonePermission && !loading) {\n      console.log('Iniciando conversación automática...');\n      // Pequeño retraso para asegurar que todo está listo\n      setTimeout(() => {\n        startConversation();\n      }, 1000);\n    }\n  }, [survey, browserSupported, microphonePermission, loading]);\n\n  // Iniciar la conversación automáticamente\n  const startConversation = async () => {\n    console.log('Función startConversation ejecutada');\n    console.log('Estado actual:', {\n      survey,\n      requiresName: survey === null || survey === void 0 ? void 0 : survey.requiresName,\n      currentStep\n    });\n    const welcomeMessage = `Bienvenido a la encuesta de voz: ${survey.title}. ${survey.description || ''}`;\n    await speakText(welcomeMessage);\n\n    // Forzar siempre a pedir el nombre para probar la funcionalidad\n    setCurrentStep('name');\n    await speakText('Para empezar, ¿podría decirme su nombre?');\n    await new Promise(resolve => setTimeout(resolve, 500)); // Pequeña pausa\n    startListening();\n  };\n\n  // Mover a la sección de preguntas\n  const moveToQuestions = async () => {\n    console.log('Moviendo a la sección de preguntas...');\n    setCurrentStep('questions');\n    setCurrentQuestionIndex(0);\n    // Pequeña pausa para asegurar que los estados se actualicen\n    await new Promise(resolve => setTimeout(resolve, 500));\n    await speakCurrentQuestion();\n  };\n\n  // Hablar la pregunta actual\n  const speakCurrentQuestion = async () => {\n    console.log('Hablando pregunta actual:', currentQuestionIndex);\n    if (!survey || currentQuestionIndex >= survey.questions.length) {\n      var _survey$questions;\n      console.error('No hay más preguntas o índice inválido:', {\n        currentQuestionIndex,\n        questionsLength: survey === null || survey === void 0 ? void 0 : (_survey$questions = survey.questions) === null || _survey$questions === void 0 ? void 0 : _survey$questions.length\n      });\n      return;\n    }\n    const question = survey.questions[currentQuestionIndex];\n    console.log('Pregunta a formular:', question);\n    let questionText = question.text;\n\n    // Añadir instrucciones específicas según tipo de pregunta\n    if (question.type === 'rating') {\n      questionText += ' Por favor, responda con un número del 1 al 5, donde 1 es lo más bajo y 5 lo más alto.';\n    } else if (question.type === 'yesno') {\n      questionText += ' Por favor, responda sí o no.';\n    }\n\n    // Hablar la pregunta\n    setIsSpeaking(true);\n    try {\n      await speakText(questionText);\n      console.log('Pregunta terminada de hablar, iniciando escucha...');\n      setIsSpeaking(false);\n      // Pequeña pausa antes de empezar a escuchar\n      await new Promise(resolve => setTimeout(resolve, 700));\n      await startListening();\n    } catch (error) {\n      console.error('Error al hablar la pregunta:', error);\n      setIsSpeaking(false);\n      // Reintentar en caso de error\n      setTimeout(() => speakCurrentQuestion(), 1000);\n    }\n  };\n\n  // Función para cuando termina de hablar la pregunta\n  const onQuestionSpeakEnd = () => {\n    setTimeout(startListening, 500);\n  };\n\n  // Función para cuando termina de hablar el mensaje de agradecimiento\n  const onThankYouSpeakEnd = async () => {\n    try {\n      // Enviar respuestas al servidor\n      await submitResponses();\n    } catch (error) {\n      console.error('Error submitting responses:', error);\n    }\n  };\n\n  // Función para enviar respuestas al servidor\n  const submitResponses = async () => {\n    try {\n      const formattedResponses = responses.map((response, index) => ({\n        questionId: survey.questions[index]._id,\n        questionText: survey.questions[index].text,\n        answer: response.value,\n        timestamp: response.timestamp\n      }));\n\n      // Usar el servicio centralizado para enviar respuestas\n      await ResponseService.submitResponse({\n        surveyId: survey._id,\n        surveyTitle: survey.title,\n        respondentName: userName || 'Anónimo',\n        responses: formattedResponses\n      });\n      console.log('Respuestas enviadas correctamente');\n      setCurrentStep('thanks');\n\n      // Hablar mensaje de agradecimiento\n      const thankYouMessage = survey.farewell || 'Gracias por completar esta encuesta. Sus respuestas han sido registradas correctamente.';\n      await speakText(thankYouMessage);\n      setShowThankYouMessage(true);\n    } catch (error) {\n      console.error('Error al enviar respuestas:', error);\n      setErrorMessage('Error al enviar respuestas. Por favor, intente nuevamente.');\n    }\n  };\n\n  // Función para iniciar escucha automáticamente\n  const startListening = async () => {\n    if (isListening) return;\n    setIsListening(true);\n    setTranscript('');\n    try {\n      const speechResult = await listenForSpeech();\n      setIsListening(false);\n      processResponse(speechResult);\n    } catch (error) {\n      console.error('Error en reconocimiento de voz:', error);\n      setIsListening(false);\n\n      // Si hubo un error, intentar nuevamente\n      await speakText(CONVERSATION_PHRASES.clarifications[Math.floor(Math.random() * CONVERSATION_PHRASES.clarifications.length)]);\n      setTimeout(() => startListening(), 1000);\n    }\n  };\n\n  // Función para procesar la respuesta del usuario con NLP mejorado\n  const processResponse = async text => {\n    setTranscript(text);\n    if (currentStep === 'name') {\n      // Extraer el nombre usando técnicas básicas de NLP\n      const possibleName = extractName(text);\n      setUserName(possibleName);\n\n      // Confirmar y seguir\n      await speakText(`Gracias, ${possibleName}. Comencemos con la encuesta.`);\n      moveToQuestions();\n      return;\n    }\n    if (currentStep === 'questions') {\n      const currentQuestion = survey.questions[currentQuestionIndex];\n\n      // Procesar la respuesta según el tipo de pregunta\n      const processedResponse = processVoiceResponse(text, currentQuestion.type);\n      if (processedResponse !== null) {\n        // Respuesta válida\n        saveResponse(processedResponse);\n\n        // Dar feedback al usuario\n        const acknowledgment = CONVERSATION_PHRASES.acknowledgments[Math.floor(Math.random() * CONVERSATION_PHRASES.acknowledgments.length)];\n        await speakText(acknowledgment);\n\n        // Transición a siguiente pregunta o finalizar\n        if (currentQuestionIndex < survey.questions.length - 1) {\n          const transition = CONVERSATION_PHRASES.transitions[Math.floor(Math.random() * CONVERSATION_PHRASES.transitions.length)];\n          await speakText(transition);\n          setCurrentQuestionIndex(prevIndex => prevIndex + 1);\n          setTimeout(() => speakCurrentQuestion(), 500);\n        } else {\n          // Finalizar encuesta\n          submitResponses();\n        }\n      } else {\n        // Respuesta inválida, pedir aclaración\n        const clarification = CONVERSATION_PHRASES.clarifications[Math.floor(Math.random() * CONVERSATION_PHRASES.clarifications.length)];\n        await speakText(clarification);\n        startListening();\n      }\n    }\n  };\n\n  // Extraer un posible nombre de un texto\n  const extractName = text => {\n    // Eliminar frases comunes de presentación\n    const cleanText = text.replace(/mi nombre es|me llamo|soy/gi, '').trim();\n\n    // Si solo queda una palabra, probablemente es el nombre\n    const words = cleanText.split(' ');\n    if (words.length === 1) return words[0];\n\n    // Si hay múltiples palabras, tomamos las primeras 2 (nombre y posible apellido)\n    return words.slice(0, 2).join(' ');\n  };\n\n  // Función para guardar respuesta y pasar a la siguiente pregunta\n  const saveResponse = value => {\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = {\n      value,\n      timestamp: new Date().toISOString()\n    };\n    setResponses(updatedResponses);\n\n    // Verificar si hay más preguntas\n    if (currentQuestionIndex < survey.questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n    } else {\n      // Fin de la encuesta\n      setCurrentStep('thanks');\n    }\n  };\n\n  // Manejar clic en botón de micrófono\n  const handleMicrophoneClick = () => {\n    if (isListening) {\n      setIsListening(false);\n    } else {\n      startListening();\n    }\n  };\n\n  // Manejar clic en botones de opciones \n  const handleOptionClick = value => {\n    if (isListening) return;\n    processResponse(value);\n  };\n\n  // Solicitar permisos de micrófono\n  const requestMicrophonePermission = async () => {\n    try {\n      const permission = await checkMicrophonePermission();\n      setMicrophonePermission(permission);\n      if (permission) {\n        // Iniciar la encuesta si se conceden los permisos\n        setCurrentStep('welcome');\n      } else {\n        setErrorMessage('No se pudo obtener permiso para el micrófono. Por favor, permita el acceso en la configuración de su navegador.');\n      }\n    } catch (error) {\n      console.error('Error al solicitar permisos de micrófono:', error);\n      setErrorMessage('Error al solicitar permisos de micrófono.');\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center my-12\",\n      children: /*#__PURE__*/_jsxDEV(\"svg\", {\n        className: \"animate-spin h-8 w-8 text-primary-500\",\n        xmlns: \"http://www.w3.org/2000/svg\",\n        fill: \"none\",\n        viewBox: \"0 0 24 24\",\n        children: [/*#__PURE__*/_jsxDEV(\"circle\", {\n          className: \"opacity-25\",\n          cx: \"12\",\n          cy: \"12\",\n          r: \"10\",\n          stroke: \"currentColor\",\n          strokeWidth: \"4\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 389,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n          className: \"opacity-75\",\n          fill: \"currentColor\",\n          d: \"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 388,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 7\n    }, this);\n  }\n  if (!survey) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card text-center py-12\",\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        className: \"h-16 w-16 mx-auto text-gray-400 mb-4\",\n        fill: \"none\",\n        viewBox: \"0 0 24 24\",\n        stroke: \"currentColor\",\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-medium text-gray-800 mb-2\",\n        children: \"Encuesta no encontrada\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600 mb-6\",\n        children: \"La encuesta que est\\xE1s buscando no existe o ha sido eliminada.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate('/'),\n        className: \"btn btn-primary\",\n        children: \"Volver al Inicio\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 7\n    }, this);\n  }\n  if (!browserSupported) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card text-center py-12\",\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        className: \"h-16 w-16 mx-auto text-orange-400 mb-4\",\n        fill: \"none\",\n        viewBox: \"0 0 24 24\",\n        stroke: \"currentColor\",\n        children: /*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-medium text-gray-800 mb-2\",\n        children: \"Navegador no compatible\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600 mb-6\",\n        children: \"Esta aplicaci\\xF3n requiere un navegador compatible con la API de Reconocimiento de Voz. Por favor, utilice Chrome, Edge o Safari para continuar.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => window.location.reload(),\n        className: \"btn btn-primary\",\n        children: \"Intentar Nuevamente\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 7\n    }, this);\n  }\n  if (microphonePermission === false) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card text-center py-12\",\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        xmlns: \"http://www.w3.org/2000/svg\",\n        className: \"h-16 w-16 mx-auto text-orange-400 mb-4\",\n        fill: \"none\",\n        viewBox: \"0 0 24 24\",\n        stroke: \"currentColor\",\n        children: [/*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 433,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"path\", {\n          strokeLinecap: \"round\",\n          strokeLinejoin: \"round\",\n          strokeWidth: 2,\n          d: \"M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 01-1-1h-2a1 1 0 01-1-1v-2a1 1 0 01 1-1h2a1 1 0 01 1 1v2a1 1 0 01 1 1h2a1 1 0 01 1 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2a1 1 0 011-1h2z\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 432,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-lg font-medium text-gray-800 mb-2\",\n        children: \"Permiso de Micr\\xF3fono Requerido\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600 mb-6\",\n        children: \"Para participar en esta encuesta por voz, necesitamos permiso para usar su micr\\xF3fono. Por favor, haga clic en el bot\\xF3n debajo para conceder acceso.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: requestMicrophonePermission,\n        className: \"btn btn-primary\",\n        children: \"Permitir Micr\\xF3fono\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 431,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white shadow-md rounded-lg p-6 mb-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-2xl font-bold mb-4\",\n        children: loading ? 'Cargando encuesta...' : survey ? survey.title : 'Encuesta no encontrada'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 452,\n        columnNumber: 9\n      }, this), errorMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          children: errorMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 457,\n          columnNumber: 13\n        }, this), !microphonePermission && /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: requestMicrophonePermission,\n          className: \"mt-2 btn btn-primary\",\n          children: \"Permitir acceso al micr\\xF3fono\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 456,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-6\",\n        children: loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center items-center h-40\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"spinner\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 473,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 13\n        }, this) : !browserSupported ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: \"Su navegador no soporta las tecnolog\\xEDas de voz necesarias para esta encuesta.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 477,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"mt-2\",\n            children: \"Por favor, use un navegador compatible como Chrome, Edge o Safari.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 478,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [isListening && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"fixed bottom-4 right-4 bg-primary-500 text-white py-2 px-4 rounded-full shadow-lg animate-pulse flex items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              className: \"h-5 w-5 mr-2\",\n              fill: \"none\",\n              viewBox: \"0 0 24 24\",\n              stroke: \"currentColor\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 486,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 485,\n              columnNumber: 19\n            }, this), \"Escuchando...\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 484,\n            columnNumber: 17\n          }, this), isSpeaking && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"fixed bottom-4 left-4 bg-blue-500 text-white py-2 px-4 rounded-full shadow-lg animate-pulse flex items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              className: \"h-5 w-5 mr-2\",\n              fill: \"none\",\n              viewBox: \"0 0 24 24\",\n              stroke: \"currentColor\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                strokeLinecap: \"round\",\n                strokeLinejoin: \"round\",\n                strokeWidth: 2,\n                d: \"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 017.072 0m-9.9-2.828a9 9 0 0112.728 0\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 496,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 495,\n              columnNumber: 19\n            }, this), \"Hablando...\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 494,\n            columnNumber: 17\n          }, this), transcript && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"bg-gray-100 p-4 rounded-lg mb-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-sm text-gray-500 mb-1\",\n              children: \"Su respuesta:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 505,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-lg\",\n              children: transcript\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 506,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 504,\n            columnNumber: 17\n          }, this), currentStep === 'questions' && currentQuestionIndex < (survey === null || survey === void 0 ? void 0 : (_survey$questions2 = survey.questions) === null || _survey$questions2 === void 0 ? void 0 : _survey$questions2.length) && /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mb-4\",\n              children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                className: \"text-lg font-semibold mb-2\",\n                children: [\"Pregunta \", currentQuestionIndex + 1, \" de \", survey.questions.length]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 514,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"text-lg\",\n                children: survey.questions[currentQuestionIndex].text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 517,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 513,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 512,\n            columnNumber: 17\n          }, this), currentStep === 'questions' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-8\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-full bg-gray-200 rounded-full h-2.5\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"bg-primary-500 h-2.5 rounded-full\",\n                style: {\n                  width: `${currentQuestionIndex / survey.questions.length * 100}%`\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 526,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-xs text-gray-500 mt-2\",\n              children: [currentQuestionIndex, \" de \", survey.questions.length, \" preguntas completadas\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 531,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 524,\n            columnNumber: 17\n          }, this), currentStep === 'thanks' && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-6 space-y-4\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-green-600\",\n              children: \"Sus respuestas han sido guardadas correctamente.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 540,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              children: survey.farewell || 'Gracias por completar esta encuesta.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 541,\n              columnNumber: 19\n            }, this), showThankYouMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"mt-6 flex space-x-4 justify-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => navigate('/surveys/public'),\n                className: \"btn btn-primary\",\n                children: \"Ver Otras Encuestas\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 545,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                onClick: () => navigate('/'),\n                className: \"btn btn-outline\",\n                children: \"Volver al Inicio\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 551,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 544,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 539,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 481,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 450,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-gray-50 p-4 rounded-lg text-sm text-gray-600\",\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"font-medium mb-2\",\n        children: \"Instrucciones:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 568,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        className: \"list-disc list-inside space-y-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Esta encuesta se realiza completamente por voz, de forma autom\\xE1tica\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Escuche atentamente cada pregunta y responda cuando termine de escucharla\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Para preguntas de calificaci\\xF3n, responda con un n\\xFAmero del 1 al 5\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 572,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Para preguntas de s\\xED/no, responda con \\\"s\\xED\\\" o \\\"no\\\"\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 573,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: \"Hable con claridad para que el sistema pueda entenderle correctamente\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 574,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 569,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 567,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 449,\n    columnNumber: 5\n  }, this);\n};\n_s(TakeSurvey, \"+PXNSUgk2Slk87lvWw9zEPmuxoE=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = TakeSurvey;\nexport default TakeSurvey;\nvar _c;\n$RefreshReg$(_c, \"TakeSurvey\");","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","isSpeechRecognitionSupported","isSpeechSynthesisSupported","listenForSpeech","speakText","processVoiceResponse","checkMicrophonePermission","SurveyService","ResponseService","SimpleVoice","jsxDEV","_jsxDEV","TakeSurvey","_s","_survey$questions2","surveyId","navigate","survey","setSurvey","loading","setLoading","currentStep","setCurrentStep","currentQuestionIndex","setCurrentQuestionIndex","userName","setUserName","responses","setResponses","isSpeaking","setIsSpeaking","isListening","setIsListening","transcript","setTranscript","errorMessage","setErrorMessage","browserSupported","setBrowserSupported","microphonePermission","setMicrophonePermission","showThankYouMessage","setShowThankYouMessage","CONVERSATION_PHRASES","acknowledgments","clarifications","transitions","checkCompatibility","speechRecognitionSupported","speechSynthesisSupported","hasMicrophonePermission","fetchSurvey","console","log","data","getPublicSurvey","questions","map","value","timestamp","error","response","status","_error$response$data","message","request","setTimeout","startConversation","requiresName","welcomeMessage","title","description","Promise","resolve","startListening","moveToQuestions","speakCurrentQuestion","length","_survey$questions","questionsLength","question","questionText","text","type","onQuestionSpeakEnd","onThankYouSpeakEnd","submitResponses","formattedResponses","index","questionId","_id","answer","submitResponse","surveyTitle","respondentName","thankYouMessage","farewell","speechResult","processResponse","Math","floor","random","possibleName","extractName","currentQuestion","processedResponse","saveResponse","acknowledgment","transition","prevIndex","clarification","cleanText","replace","trim","words","split","slice","join","updatedResponses","Date","toISOString","handleMicrophoneClick","handleOptionClick","requestMicrophonePermission","permission","className","children","xmlns","fill","viewBox","cx","cy","r","stroke","strokeWidth","fileName","_jsxFileName","lineNumber","columnNumber","d","strokeLinecap","strokeLinejoin","onClick","window","location","reload","style","width","_c","$RefreshReg$"],"sources":["C:/Users/josep/Documents/Sistema de Encuestas por Voz/client/src/pages/TakeSurvey.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { \n  isSpeechRecognitionSupported,\n  isSpeechSynthesisSupported,\n  listenForSpeech,\n  speakText,\n  processVoiceResponse,\n  checkMicrophonePermission\n} from '../utils/voiceSurveyAPI';\nimport { SurveyService, ResponseService } from '../services/apiService';\nimport SimpleVoice from '../components/SimpleVoice';\n\nconst TakeSurvey = () => {\n  const { surveyId } = useParams();\n  const navigate = useNavigate();\n  const [survey, setSurvey] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [currentStep, setCurrentStep] = useState('welcome'); // welcome, name, questions, thanks\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [userName, setUserName] = useState('');\n  const [responses, setResponses] = useState([]);\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [isListening, setIsListening] = useState(false);\n  const [transcript, setTranscript] = useState('');\n  const [errorMessage, setErrorMessage] = useState('');\n  const [browserSupported, setBrowserSupported] = useState(true);\n  const [microphonePermission, setMicrophonePermission] = useState(null);\n  const [showThankYouMessage, setShowThankYouMessage] = useState(false);\n\n  // Frases para mejorar la naturalidad de la conversación\n  const CONVERSATION_PHRASES = {\n    acknowledgments: [\n      'Entendido.',\n      'Perfecto.',\n      'Muy bien.',\n      'Gracias por su respuesta.',\n      'He registrado su respuesta.'\n    ],\n    clarifications: [\n      'No he entendido bien. ¿Podría repetirlo?',\n      'Disculpe, ¿podría decirlo de nuevo?',\n      'No pude entender su respuesta. Intentemos de nuevo.'\n    ],\n    transitions: [\n      'Pasemos a la siguiente pregunta.',\n      'Continuamos con la siguiente pregunta.',\n      'Ahora, la siguiente pregunta.'\n    ]\n  };\n\n  // Comprobar compatibilidad del navegador y permisos\n  useEffect(() => {\n    const checkCompatibility = async () => {\n      // Verificar si el navegador soporta reconocimiento de voz\n      const speechRecognitionSupported = isSpeechRecognitionSupported();\n      const speechSynthesisSupported = isSpeechSynthesisSupported();\n\n      if (!speechRecognitionSupported || !speechSynthesisSupported) {\n        setBrowserSupported(false);\n        setErrorMessage('Su navegador no soporta las tecnologías de voz necesarias para esta encuesta. Por favor, use Chrome, Edge o Safari.');\n        return;\n      }\n\n      // Verificar permisos de micrófono\n      const hasMicrophonePermission = await checkMicrophonePermission();\n      setMicrophonePermission(hasMicrophonePermission);\n\n      if (!hasMicrophonePermission) {\n        setErrorMessage('Necesitamos permiso para usar su micrófono. Por favor, permita el acceso cuando se le solicite.');\n      }\n    };\n\n    checkCompatibility();\n  }, []);\n\n  // Obtener datos de la encuesta\n  useEffect(() => {\n    const fetchSurvey = async () => {\n      try {\n        setLoading(true);\n        console.log(`Intentando cargar la encuesta con ID: ${surveyId}`);\n        \n        // Usar el servicio centralizado para obtener la encuesta pública\n        const data = await SurveyService.getPublicSurvey(surveyId);\n        \n        if (data) {\n          console.log('Encuesta cargada exitosamente:', data);\n          setSurvey(data);\n          // Inicializar array de respuestas\n          setResponses(data.questions.map(() => ({ value: '', timestamp: null })));\n        } else {\n          console.error('La respuesta no contiene datos');\n          setErrorMessage('La encuesta no contiene datos válidos.');\n        }\n        \n        setLoading(false);\n      } catch (error) {\n        console.error('Error fetching survey:', error);\n        \n        // Mensajes de error más específicos\n        if (error.response) {\n          // El servidor respondió con un código de error\n          if (error.response.status === 404) {\n            setErrorMessage('Encuesta no encontrada. El ID proporcionado no corresponde a ninguna encuesta existente.');\n          } else if (error.response.status === 403) {\n            setErrorMessage('Esta encuesta ya no está activa o no es pública.');\n          } else {\n            setErrorMessage(`Error del servidor: ${error.response.data?.message || 'Error desconocido'}`);\n          }\n        } else if (error.request) {\n          // La solicitud se hizo pero no se recibió respuesta\n          setErrorMessage('No se pudo conectar con el servidor. Verifica tu conexión a internet.');\n        } else {\n          // Error al configurar la solicitud\n          setErrorMessage('Error al crear la solicitud: ' + error.message);\n        }\n        \n        setLoading(false);\n      }\n    };\n    \n    if (surveyId) {\n      fetchSurvey();\n    }\n  }, [surveyId]);\n\n  // Efecto para iniciar la conversación cuando la encuesta se carga correctamente\n  useEffect(() => {\n    if (survey && browserSupported && microphonePermission && !loading) {\n      console.log('Iniciando conversación automática...');\n      // Pequeño retraso para asegurar que todo está listo\n      setTimeout(() => {\n        startConversation();\n      }, 1000);\n    }\n  }, [survey, browserSupported, microphonePermission, loading]);\n\n  // Iniciar la conversación automáticamente\n  const startConversation = async () => {\n    console.log('Función startConversation ejecutada');\n    console.log('Estado actual:', { \n      survey, \n      requiresName: survey?.requiresName,\n      currentStep\n    });\n    \n    const welcomeMessage = `Bienvenido a la encuesta de voz: ${survey.title}. ${survey.description || ''}`;\n    await speakText(welcomeMessage);\n    \n    // Forzar siempre a pedir el nombre para probar la funcionalidad\n    setCurrentStep('name');\n    await speakText('Para empezar, ¿podría decirme su nombre?');\n    await new Promise(resolve => setTimeout(resolve, 500)); // Pequeña pausa\n    startListening();\n  };\n\n  // Mover a la sección de preguntas\n  const moveToQuestions = async () => {\n    console.log('Moviendo a la sección de preguntas...');\n    setCurrentStep('questions');\n    setCurrentQuestionIndex(0);\n    // Pequeña pausa para asegurar que los estados se actualicen\n    await new Promise(resolve => setTimeout(resolve, 500));\n    await speakCurrentQuestion();\n  };\n\n  // Hablar la pregunta actual\n  const speakCurrentQuestion = async () => {\n    console.log('Hablando pregunta actual:', currentQuestionIndex);\n    if (!survey || currentQuestionIndex >= survey.questions.length) {\n      console.error('No hay más preguntas o índice inválido:', {currentQuestionIndex, questionsLength: survey?.questions?.length});\n      return;\n    }\n    \n    const question = survey.questions[currentQuestionIndex];\n    console.log('Pregunta a formular:', question);\n    let questionText = question.text;\n    \n    // Añadir instrucciones específicas según tipo de pregunta\n    if (question.type === 'rating') {\n      questionText += ' Por favor, responda con un número del 1 al 5, donde 1 es lo más bajo y 5 lo más alto.';\n    } else if (question.type === 'yesno') {\n      questionText += ' Por favor, responda sí o no.';\n    }\n    \n    // Hablar la pregunta\n    setIsSpeaking(true);\n    try {\n      await speakText(questionText);\n      console.log('Pregunta terminada de hablar, iniciando escucha...');\n      setIsSpeaking(false);\n      // Pequeña pausa antes de empezar a escuchar\n      await new Promise(resolve => setTimeout(resolve, 700));\n      await startListening();\n    } catch (error) {\n      console.error('Error al hablar la pregunta:', error);\n      setIsSpeaking(false);\n      // Reintentar en caso de error\n      setTimeout(() => speakCurrentQuestion(), 1000);\n    }\n  };\n\n  // Función para cuando termina de hablar la pregunta\n  const onQuestionSpeakEnd = () => {\n    setTimeout(startListening, 500);\n  };\n\n  // Función para cuando termina de hablar el mensaje de agradecimiento\n  const onThankYouSpeakEnd = async () => {\n    try {\n      // Enviar respuestas al servidor\n      await submitResponses();\n    } catch (error) {\n      console.error('Error submitting responses:', error);\n    }\n  };\n\n  // Función para enviar respuestas al servidor\n  const submitResponses = async () => {\n    try {\n      const formattedResponses = responses.map((response, index) => ({\n        questionId: survey.questions[index]._id,\n        questionText: survey.questions[index].text,\n        answer: response.value,\n        timestamp: response.timestamp\n      }));\n\n      // Usar el servicio centralizado para enviar respuestas\n      await ResponseService.submitResponse({\n        surveyId: survey._id,\n        surveyTitle: survey.title,\n        respondentName: userName || 'Anónimo',\n        responses: formattedResponses\n      });\n\n      console.log('Respuestas enviadas correctamente');\n      setCurrentStep('thanks');\n      \n      // Hablar mensaje de agradecimiento\n      const thankYouMessage = survey.farewell || 'Gracias por completar esta encuesta. Sus respuestas han sido registradas correctamente.';\n      await speakText(thankYouMessage);\n      setShowThankYouMessage(true);\n      \n    } catch (error) {\n      console.error('Error al enviar respuestas:', error);\n      setErrorMessage('Error al enviar respuestas. Por favor, intente nuevamente.');\n    }\n  };\n\n  // Función para iniciar escucha automáticamente\n  const startListening = async () => {\n    if (isListening) return;\n    \n    setIsListening(true);\n    setTranscript('');\n    \n    try {\n      const speechResult = await listenForSpeech();\n      setIsListening(false);\n      processResponse(speechResult);\n    } catch (error) {\n      console.error('Error en reconocimiento de voz:', error);\n      setIsListening(false);\n      \n      // Si hubo un error, intentar nuevamente\n      await speakText(CONVERSATION_PHRASES.clarifications[Math.floor(Math.random() * CONVERSATION_PHRASES.clarifications.length)]);\n      setTimeout(() => startListening(), 1000);\n    }\n  };\n\n  // Función para procesar la respuesta del usuario con NLP mejorado\n  const processResponse = async (text) => {\n    setTranscript(text);\n    \n    if (currentStep === 'name') {\n      // Extraer el nombre usando técnicas básicas de NLP\n      const possibleName = extractName(text);\n      setUserName(possibleName);\n      \n      // Confirmar y seguir\n      await speakText(`Gracias, ${possibleName}. Comencemos con la encuesta.`);\n      moveToQuestions();\n      return;\n    }\n    \n    if (currentStep === 'questions') {\n      const currentQuestion = survey.questions[currentQuestionIndex];\n      \n      // Procesar la respuesta según el tipo de pregunta\n      const processedResponse = processVoiceResponse(text, currentQuestion.type);\n      \n      if (processedResponse !== null) {\n        // Respuesta válida\n        saveResponse(processedResponse);\n        \n        // Dar feedback al usuario\n        const acknowledgment = CONVERSATION_PHRASES.acknowledgments[Math.floor(Math.random() * CONVERSATION_PHRASES.acknowledgments.length)];\n        await speakText(acknowledgment);\n        \n        // Transición a siguiente pregunta o finalizar\n        if (currentQuestionIndex < survey.questions.length - 1) {\n          const transition = CONVERSATION_PHRASES.transitions[Math.floor(Math.random() * CONVERSATION_PHRASES.transitions.length)];\n          await speakText(transition);\n          setCurrentQuestionIndex(prevIndex => prevIndex + 1);\n          setTimeout(() => speakCurrentQuestion(), 500);\n        } else {\n          // Finalizar encuesta\n          submitResponses();\n        }\n      } else {\n        // Respuesta inválida, pedir aclaración\n        const clarification = CONVERSATION_PHRASES.clarifications[Math.floor(Math.random() * CONVERSATION_PHRASES.clarifications.length)];\n        await speakText(clarification);\n        startListening();\n      }\n    }\n  };\n\n  // Extraer un posible nombre de un texto\n  const extractName = (text) => {\n    // Eliminar frases comunes de presentación\n    const cleanText = text.replace(/mi nombre es|me llamo|soy/gi, '').trim();\n    \n    // Si solo queda una palabra, probablemente es el nombre\n    const words = cleanText.split(' ');\n    if (words.length === 1) return words[0];\n    \n    // Si hay múltiples palabras, tomamos las primeras 2 (nombre y posible apellido)\n    return words.slice(0, 2).join(' ');\n  };\n\n  // Función para guardar respuesta y pasar a la siguiente pregunta\n  const saveResponse = (value) => {\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = {\n      value,\n      timestamp: new Date().toISOString()\n    };\n    setResponses(updatedResponses);\n\n    // Verificar si hay más preguntas\n    if (currentQuestionIndex < survey.questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n    } else {\n      // Fin de la encuesta\n      setCurrentStep('thanks');\n    }\n  };\n\n  // Manejar clic en botón de micrófono\n  const handleMicrophoneClick = () => {\n    if (isListening) {\n      setIsListening(false);\n    } else {\n      startListening();\n    }\n  };\n\n  // Manejar clic en botones de opciones \n  const handleOptionClick = (value) => {\n    if (isListening) return;\n\n    processResponse(value);\n  };\n\n  // Solicitar permisos de micrófono\n  const requestMicrophonePermission = async () => {\n    try {\n      const permission = await checkMicrophonePermission();\n      setMicrophonePermission(permission);\n\n      if (permission) {\n        // Iniciar la encuesta si se conceden los permisos\n        setCurrentStep('welcome');\n      } else {\n        setErrorMessage('No se pudo obtener permiso para el micrófono. Por favor, permita el acceso en la configuración de su navegador.');\n      }\n    } catch (error) {\n      console.error('Error al solicitar permisos de micrófono:', error);\n      setErrorMessage('Error al solicitar permisos de micrófono.');\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center my-12\">\n        <svg className=\"animate-spin h-8 w-8 text-primary-500\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n          <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n          <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n        </svg>\n      </div>\n    );\n  }\n\n  if (!survey) {\n    return (\n      <div className=\"card text-center py-12\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-16 w-16 mx-auto text-gray-400 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\n        </svg>\n        <h3 className=\"text-lg font-medium text-gray-800 mb-2\">Encuesta no encontrada</h3>\n        <p className=\"text-gray-600 mb-6\">La encuesta que estás buscando no existe o ha sido eliminada.</p>\n        <button onClick={() => navigate('/')} className=\"btn btn-primary\">\n          Volver al Inicio\n        </button>\n      </div>\n    );\n  }\n\n  if (!browserSupported) {\n    return (\n      <div className=\"card text-center py-12\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-16 w-16 mx-auto text-orange-400 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n        </svg>\n        <h3 className=\"text-lg font-medium text-gray-800 mb-2\">Navegador no compatible</h3>\n        <p className=\"text-gray-600 mb-6\">\n          Esta aplicación requiere un navegador compatible con la API de Reconocimiento de Voz.\n          Por favor, utilice Chrome, Edge o Safari para continuar.\n        </p>\n        <button onClick={() => window.location.reload()} className=\"btn btn-primary\">\n          Intentar Nuevamente\n        </button>\n      </div>\n    );\n  }\n\n  if (microphonePermission === false) {\n    return (\n      <div className=\"card text-center py-12\">\n        <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-16 w-16 mx-auto text-orange-400 mb-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4a1 1 0 01-1-1h-2a1 1 0 01-1-1v-2a1 1 0 01 1-1h2a1 1 0 01 1 1v2a1 1 0 01 1 1h2a1 1 0 01 1 1v2a1 1 0 01-1 1h-2a1 1 0 01-1-1v-2a1 1 0 011-1h2z\" />\n        </svg>\n        <h3 className=\"text-lg font-medium text-gray-800 mb-2\">Permiso de Micrófono Requerido</h3>\n        <p className=\"text-gray-600 mb-6\">\n          Para participar en esta encuesta por voz, necesitamos permiso para usar su micrófono.\n          Por favor, haga clic en el botón debajo para conceder acceso.\n        </p>\n        <button onClick={requestMicrophonePermission} className=\"btn btn-primary\">\n          Permitir Micrófono\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-3xl mx-auto p-4\">\n      <div className=\"bg-white shadow-md rounded-lg p-6 mb-6\">\n        {/* Encabezado */}\n        <h1 className=\"text-2xl font-bold mb-4\">{loading ? 'Cargando encuesta...' : (survey ? survey.title : 'Encuesta no encontrada')}</h1>\n        \n        {/* Mensajes de error */}\n        {errorMessage && (\n          <div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4\">\n            <p>{errorMessage}</p>\n            {!microphonePermission && (\n              <button\n                onClick={requestMicrophonePermission}\n                className=\"mt-2 btn btn-primary\"\n              >\n                Permitir acceso al micrófono\n              </button>\n            )}\n          </div>\n        )}\n\n        {/* Contenido principal */}\n        <div className=\"mb-6\">\n          {loading ? (\n            <div className=\"flex justify-center items-center h-40\">\n              <div className=\"spinner\"></div>\n            </div>\n          ) : !browserSupported ? (\n            <div className=\"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded\">\n              <p>Su navegador no soporta las tecnologías de voz necesarias para esta encuesta.</p>\n              <p className=\"mt-2\">Por favor, use un navegador compatible como Chrome, Edge o Safari.</p>\n            </div>\n          ) : (\n            <div>\n              {/* Indicador de escucha activa */}\n              {isListening && (\n                <div className=\"fixed bottom-4 right-4 bg-primary-500 text-white py-2 px-4 rounded-full shadow-lg animate-pulse flex items-center\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\" />\n                  </svg>\n                  Escuchando...\n                </div>\n              )}\n              \n              {/* Indicador de habla activa */}\n              {isSpeaking && (\n                <div className=\"fixed bottom-4 left-4 bg-blue-500 text-white py-2 px-4 rounded-full shadow-lg animate-pulse flex items-center\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 017.072 0m-9.9-2.828a9 9 0 0112.728 0\" />\n                  </svg>\n                  Hablando...\n                </div>\n              )}\n              \n              {/* Transcripción de voz */}\n              {transcript && (\n                <div className=\"bg-gray-100 p-4 rounded-lg mb-6\">\n                  <div className=\"text-sm text-gray-500 mb-1\">Su respuesta:</div>\n                  <div className=\"text-lg\">{transcript}</div>\n                </div>\n              )}\n              \n              {/* Contenido según el paso actual */}\n              {currentStep === 'questions' && currentQuestionIndex < survey?.questions?.length && (\n                <div>\n                  <div className=\"mb-4\">\n                    <h3 className=\"text-lg font-semibold mb-2\">\n                      Pregunta {currentQuestionIndex + 1} de {survey.questions.length}\n                    </h3>\n                    <p className=\"text-lg\">{survey.questions[currentQuestionIndex].text}</p>\n                  </div>\n                </div>\n              )}\n              \n              {/* Progreso de la encuesta */}\n              {currentStep === 'questions' && (\n                <div className=\"mt-8\">\n                  <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\n                    <div\n                      className=\"bg-primary-500 h-2.5 rounded-full\"\n                      style={{ width: `${((currentQuestionIndex) / survey.questions.length) * 100}%` }}\n                    ></div>\n                  </div>\n                  <div className=\"text-xs text-gray-500 mt-2\">\n                    {currentQuestionIndex} de {survey.questions.length} preguntas completadas\n                  </div>\n                </div>\n              )}\n              \n              {/* Mensaje final */}\n              {currentStep === 'thanks' && (\n                <div className=\"mt-6 space-y-4\">\n                  <p className=\"text-green-600\">Sus respuestas han sido guardadas correctamente.</p>\n                  <p>{survey.farewell || 'Gracias por completar esta encuesta.'}</p>\n                  \n                  {showThankYouMessage && (\n                    <div className=\"mt-6 flex space-x-4 justify-center\">\n                      <button\n                        onClick={() => navigate('/surveys/public')}\n                        className=\"btn btn-primary\"\n                      >\n                        Ver Otras Encuestas\n                      </button>\n                      <button\n                        onClick={() => navigate('/')}\n                        className=\"btn btn-outline\"\n                      >\n                        Volver al Inicio\n                      </button>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Instrucciones actualizadas */}\n      <div className=\"bg-gray-50 p-4 rounded-lg text-sm text-gray-600\">\n        <h3 className=\"font-medium mb-2\">Instrucciones:</h3>\n        <ul className=\"list-disc list-inside space-y-1\">\n          <li>Esta encuesta se realiza completamente por voz, de forma automática</li>\n          <li>Escuche atentamente cada pregunta y responda cuando termine de escucharla</li>\n          <li>Para preguntas de calificación, responda con un número del 1 al 5</li>\n          <li>Para preguntas de sí/no, responda con \"sí\" o \"no\"</li>\n          <li>Hable con claridad para que el sistema pueda entenderle correctamente</li>\n        </ul>\n      </div>\n    </div>\n  );\n};\n\nexport default TakeSurvey;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}