{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\josep\\\\Documents\\\\Sistema de Encuestas por Voz\\\\client\\\\src\\\\pages\\\\VoiceTest.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport SimpleVoice from '../components/SimpleVoice';\nimport audioService from '../services/audioService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VoiceTest = () => {\n  _s();\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [isListening, setIsListening] = useState(false);\n  const [text, setText] = useState('Hola, soy tu asistente virtual. ¿En qué puedo ayudarte hoy?');\n  const [recognizedText, setRecognizedText] = useState('');\n  const [status, setStatus] = useState('');\n  const [voicesAvailable, setVoicesAvailable] = useState([]);\n  const [speechSupported, setSpeechSupported] = useState(false);\n  const [recognitionSupported, setRecognitionSupported] = useState(false);\n  const [micPermission, setMicPermission] = useState('unknown'); // 'unknown', 'granted', 'denied'\n  const [conversation, setConversation] = useState([]);\n  const conversationRef = useRef([]);\n  const lastUtteranceRef = useRef(''); // Almacena la última frase hablada por el sistema\n\n  useEffect(() => {\n    // Inicializar el sistema de voz y comprobar compatibilidad\n    const speechSystemInitialized = audioService.initSpeechSystem();\n    const recognitionSupported = audioService.isSupportedByBrowser();\n    setSpeechSupported(speechSystemInitialized);\n    setRecognitionSupported(recognitionSupported);\n\n    // Obtener lista de voces disponibles\n    setTimeout(() => {\n      if (window.speechSynthesis) {\n        const voices = window.speechSynthesis.getVoices();\n        const spanishVoices = voices.filter(v => v.lang.includes('es') || v.name.toLowerCase().includes('spanish'));\n        setVoicesAvailable(spanishVoices.length > 0 ? spanishVoices : voices);\n      }\n    }, 500);\n\n    // Configurar el callback para cambios en el permiso del micrófono\n    audioService.onPermissionChange((granted, errorMsg) => {\n      setMicPermission(granted ? 'granted' : 'denied');\n      if (!granted && errorMsg) {\n        setStatus(`Error de permiso: ${errorMsg}`);\n      }\n    });\n\n    // Agregar el mensaje inicial al historial de conversación\n    addToConversation('system', text);\n\n    // Hablar el mensaje inicial automáticamente después de un breve retraso\n    const timer = setTimeout(() => {\n      handleSpeak();\n    }, 1000);\n    return () => {\n      // Limpiar al desmontar\n      clearTimeout(timer);\n      if (window.speechSynthesis) {\n        window.speechSynthesis.cancel();\n      }\n      if (isListening) {\n        audioService.stop();\n      }\n    };\n  }, []);\n\n  // Función para añadir mensajes al historial de conversación\n  const addToConversation = (speaker, message) => {\n    const newMessage = {\n      id: Date.now(),\n      speaker,\n      message,\n      timestamp: new Date().toISOString()\n    };\n    const updatedConversation = [...conversationRef.current, newMessage];\n    conversationRef.current = updatedConversation;\n    setConversation(updatedConversation);\n  };\n\n  // Función para iniciar la síntesis de voz\n  const handleSpeak = () => {\n    if (!text.trim()) {\n      setStatus('El texto no puede estar vacío');\n      return;\n    }\n\n    // Guardar la última frase para evitar repetición\n    lastUtteranceRef.current = text;\n    setIsSpeaking(true);\n    setStatus('Hablando...');\n\n    // Añadir el mensaje del sistema a la conversación\n    if (!conversation.some(item => item.message === text && item.speaker === 'system')) {\n      addToConversation('system', text);\n    }\n    audioService.speakText(text, () => {\n      setStatus('Hablando...');\n    }, () => {\n      setIsSpeaking(false);\n      setStatus('Listo para escuchar');\n      // Iniciar automáticamente la escucha después de hablar\n      if (recognitionSupported && micPermission === 'granted') {\n        startVoiceRecognition();\n      } else if (recognitionSupported && micPermission === 'unknown') {\n        // Solicitar permiso si aún no se ha solicitado\n        requestMicrophonePermission();\n      }\n    }, error => {\n      setIsSpeaking(false);\n      setStatus(`Error: ${error}`);\n    });\n  };\n\n  // Función para detener la síntesis de voz\n  const handleStop = () => {\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n      setIsSpeaking(false);\n      setStatus('Síntesis detenida');\n    }\n  };\n\n  // Solicitar permiso para usar el micrófono\n  const requestMicrophonePermission = async () => {\n    setStatus('Solicitando permiso para el micrófono...');\n    const granted = await audioService.requestMicrophonePermission();\n    if (granted) {\n      setMicPermission('granted');\n      setStatus('Permiso para micrófono concedido');\n      startVoiceRecognition();\n    } else {\n      setMicPermission('denied');\n      setStatus('Se requiere permiso para el micrófono para usar esta función');\n    }\n  };\n\n  // Simular una respuesta automática natural basada en lo que dijo el usuario\n  const getAutoResponse = userInput => {\n    const input = userInput.toLowerCase();\n\n    // Respuestas comunes de conversación\n    if (input.includes('hola') || input.includes('buenos días') || input.includes('buenas tardes') || input.includes('buenas noches')) {\n      return '¡Hola! ¿Cómo estás hoy? ¿En qué puedo ayudarte?';\n    }\n    if (input.includes('cómo estás') || input.includes('como estas')) {\n      return 'Estoy muy bien, gracias por preguntar. ¿Y tú cómo estás?';\n    }\n    if (input.includes('gracias') || input.includes('te lo agradezco')) {\n      return 'De nada. Estoy aquí para ayudarte. ¿Hay algo más que necesites?';\n    }\n    if (input.includes('adiós') || input.includes('hasta luego') || input.includes('chao')) {\n      return 'Hasta luego. Fue un placer hablar contigo. ¡Que tengas un buen día!';\n    }\n    if (input.includes('bien') || input.includes('excelente') || input.includes('muy bien')) {\n      return 'Me alegra escuchar eso. ¿En qué puedo ayudarte hoy?';\n    }\n    if (input.includes('mal') || input.includes('triste') || input.includes('no muy bien')) {\n      return 'Lamento escuchar eso. Espero que tu día mejore pronto. ¿Hay algo en lo que pueda ayudarte?';\n    }\n\n    // Respuesta genérica si no coincide con ningún patrón\n    return 'Entiendo. ¿Hay algo específico en lo que pueda ayudarte hoy?';\n  };\n\n  // Iniciar reconocimiento de voz\n  const startVoiceRecognition = async () => {\n    if (!audioService.isSupportedByBrowser()) {\n      setStatus('Tu navegador no soporta reconocimiento de voz');\n      return;\n    }\n    if (micPermission !== 'granted') {\n      await requestMicrophonePermission();\n      return;\n    }\n    audioService.init('es-ES');\n    setRecognizedText('');\n    audioService.onResult((transcript, isFinal) => {\n      setRecognizedText(transcript);\n      setStatus(isFinal ? 'Procesando...' : 'Escuchando...');\n    });\n    audioService.onEnd(finalTranscript => {\n      setIsListening(false);\n      setStatus('Procesando tu mensaje...');\n\n      // Verificar si se reconoció algo de texto\n      if (finalTranscript && finalTranscript.trim()) {\n        // Añadir el mensaje del usuario a la conversación\n        addToConversation('user', finalTranscript);\n\n        // Generar una respuesta automática\n        setTimeout(() => {\n          const response = getAutoResponse(finalTranscript);\n          setText(response);\n\n          // Iniciar síntesis de voz con un pequeño retraso para simular \"pensamiento\"\n          setTimeout(handleSpeak, 500);\n        }, 1000);\n      } else {\n        setStatus('No se detectó ningún mensaje. Puedes intentarlo de nuevo.');\n      }\n    });\n    audioService.onError(errorMessage => {\n      if (errorMessage === 'no-speech') {\n        setStatus('No se detectó ninguna voz. Por favor, intenta hablar de nuevo.');\n      } else {\n        setStatus(`Error de reconocimiento: ${errorMessage}`);\n      }\n      setIsListening(false);\n    });\n    try {\n      const started = await audioService.start();\n      if (started) {\n        setIsListening(true);\n        setStatus('Escuchando...');\n      } else {\n        setStatus('No se pudo iniciar el reconocimiento de voz');\n      }\n    } catch (error) {\n      setStatus(`Error al iniciar reconocimiento: ${error.message || 'Error desconocido'}`);\n    }\n  };\n\n  // Detener reconocimiento de voz\n  const stopVoiceRecognition = () => {\n    audioService.stop();\n    setIsListening(false);\n    setStatus('Reconocimiento detenido');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto p-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"text-3xl font-bold mb-6 text-center\",\n      children: \"Conversaci\\xF3n por Voz\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-lg shadow-md p-4 mb-6\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-lg font-bold\",\n            children: \"Estado del Sistema\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 253,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex flex-wrap gap-3 mt-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: `inline-block px-3 py-1 rounded-full text-sm ${speechSupported ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`,\n              children: speechSupported ? '✓ Síntesis disponible' : '✗ Síntesis no disponible'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 255,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `inline-block px-3 py-1 rounded-full text-sm ${recognitionSupported ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`,\n              children: recognitionSupported ? '✓ Reconocimiento disponible' : '✗ Reconocimiento no disponible'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 258,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `inline-block px-3 py-1 rounded-full text-sm ${micPermission === 'granted' ? 'bg-green-100 text-green-800' : micPermission === 'denied' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}`,\n              children: micPermission === 'granted' ? '✓ Micrófono permitido' : micPermission === 'denied' ? '✗ Micrófono bloqueado' : '? Permiso de micrófono pendiente'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 261,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 254,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 252,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex space-x-2\",\n          children: [micPermission !== 'granted' && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: requestMicrophonePermission,\n            className: \"px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white\",\n            children: \"Permitir Micr\\xF3fono\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 15\n          }, this), !isListening && micPermission === 'granted' && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: startVoiceRecognition,\n            className: \"px-4 py-2 rounded-md bg-green-600 hover:bg-green-700 text-white flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              className: \"h-5 w-5\",\n              viewBox: \"0 0 20 20\",\n              fill: \"currentColor\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                fillRule: \"evenodd\",\n                d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                clipRule: \"evenodd\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 289,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 17\n            }, this), \"Hablar\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 15\n          }, this), isListening && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: stopVoiceRecognition,\n            className: \"px-4 py-2 rounded-md bg-red-600 hover:bg-red-700 text-white flex items-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              className: \"h-5 w-5\",\n              viewBox: \"0 0 20 20\",\n              fill: \"currentColor\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                fillRule: \"evenodd\",\n                d: \"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z\",\n                clipRule: \"evenodd\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 300,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 299,\n              columnNumber: 17\n            }, this), \"Detener\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-lg shadow-md p-6 mb-6 max-h-[400px] overflow-y-auto\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-xl font-bold mb-4\",\n        children: \"Conversaci\\xF3n\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }, this), conversation.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center text-gray-500 py-4\",\n        children: \"La conversaci\\xF3n comenzar\\xE1 pronto...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"space-y-4\",\n        children: conversation.map(msg => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `p-3 rounded-lg ${msg.speaker === 'system' ? 'bg-blue-50 ml-4' : 'bg-green-50 mr-4'}`,\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"font-semibold text-sm text-gray-600 mb-1\",\n            children: msg.speaker === 'system' ? 'Asistente' : 'Tú'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: msg.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 325,\n            columnNumber: 17\n          }, this)]\n        }, msg.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 310,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-gray-50 rounded-lg shadow-md p-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center justify-between mb-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"text-sm font-medium text-gray-700\",\n          children: [\"Estado: \", /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"font-bold\",\n            children: status || \"Listo\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 336,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 11\n        }, this), isListening && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"mr-1 h-2 w-2 rounded-full bg-green-500 animate-pulse\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 340,\n            columnNumber: 15\n          }, this), \"Escuchando\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 339,\n          columnNumber: 13\n        }, this), isSpeaking && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"mr-1 h-2 w-2 rounded-full bg-blue-500 animate-pulse\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 15\n          }, this), \"Hablando\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 9\n      }, this), isListening && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"border border-gray-300 rounded-md p-3 bg-white\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-700\",\n          children: recognizedText || \"Esperando que hables...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 11\n      }, this), isSpeaking && /*#__PURE__*/_jsxDEV(SimpleVoice, {\n        text: \"\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 24\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 246,\n    columnNumber: 5\n  }, this);\n};\n_s(VoiceTest, \"obbTu38UyxLhwZyAl+YFPQTPCJ8=\");\n_c = VoiceTest;\nexport default VoiceTest;\nvar _c;\n$RefreshReg$(_c, \"VoiceTest\");","map":{"version":3,"names":["React","useState","useEffect","useRef","SimpleVoice","audioService","jsxDEV","_jsxDEV","VoiceTest","_s","isSpeaking","setIsSpeaking","isListening","setIsListening","text","setText","recognizedText","setRecognizedText","status","setStatus","voicesAvailable","setVoicesAvailable","speechSupported","setSpeechSupported","recognitionSupported","setRecognitionSupported","micPermission","setMicPermission","conversation","setConversation","conversationRef","lastUtteranceRef","speechSystemInitialized","initSpeechSystem","isSupportedByBrowser","setTimeout","window","speechSynthesis","voices","getVoices","spanishVoices","filter","v","lang","includes","name","toLowerCase","length","onPermissionChange","granted","errorMsg","addToConversation","timer","handleSpeak","clearTimeout","cancel","stop","speaker","message","newMessage","id","Date","now","timestamp","toISOString","updatedConversation","current","trim","some","item","speakText","startVoiceRecognition","requestMicrophonePermission","error","handleStop","getAutoResponse","userInput","input","init","onResult","transcript","isFinal","onEnd","finalTranscript","response","onError","errorMessage","started","start","stopVoiceRecognition","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","xmlns","viewBox","fill","fillRule","d","clipRule","map","msg","_c","$RefreshReg$"],"sources":["C:/Users/josep/Documents/Sistema de Encuestas por Voz/client/src/pages/VoiceTest.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport SimpleVoice from '../components/SimpleVoice';\nimport audioService from '../services/audioService';\n\nconst VoiceTest = () => {\n  const [isSpeaking, setIsSpeaking] = useState(false);\n  const [isListening, setIsListening] = useState(false);\n  const [text, setText] = useState('Hola, soy tu asistente virtual. ¿En qué puedo ayudarte hoy?');\n  const [recognizedText, setRecognizedText] = useState('');\n  const [status, setStatus] = useState('');\n  const [voicesAvailable, setVoicesAvailable] = useState([]);\n  const [speechSupported, setSpeechSupported] = useState(false);\n  const [recognitionSupported, setRecognitionSupported] = useState(false);\n  const [micPermission, setMicPermission] = useState('unknown'); // 'unknown', 'granted', 'denied'\n  const [conversation, setConversation] = useState([]);\n  const conversationRef = useRef([]);\n  const lastUtteranceRef = useRef('');  // Almacena la última frase hablada por el sistema\n\n  useEffect(() => {\n    // Inicializar el sistema de voz y comprobar compatibilidad\n    const speechSystemInitialized = audioService.initSpeechSystem();\n    const recognitionSupported = audioService.isSupportedByBrowser();\n    \n    setSpeechSupported(speechSystemInitialized);\n    setRecognitionSupported(recognitionSupported);\n    \n    // Obtener lista de voces disponibles\n    setTimeout(() => {\n      if (window.speechSynthesis) {\n        const voices = window.speechSynthesis.getVoices();\n        const spanishVoices = voices.filter(v => \n          v.lang.includes('es') || \n          v.name.toLowerCase().includes('spanish')\n        );\n        setVoicesAvailable(spanishVoices.length > 0 ? spanishVoices : voices);\n      }\n    }, 500);\n    \n    // Configurar el callback para cambios en el permiso del micrófono\n    audioService.onPermissionChange((granted, errorMsg) => {\n      setMicPermission(granted ? 'granted' : 'denied');\n      if (!granted && errorMsg) {\n        setStatus(`Error de permiso: ${errorMsg}`);\n      }\n    });\n    \n    // Agregar el mensaje inicial al historial de conversación\n    addToConversation('system', text);\n    \n    // Hablar el mensaje inicial automáticamente después de un breve retraso\n    const timer = setTimeout(() => {\n      handleSpeak();\n    }, 1000);\n    \n    return () => {\n      // Limpiar al desmontar\n      clearTimeout(timer);\n      if (window.speechSynthesis) {\n        window.speechSynthesis.cancel();\n      }\n      if (isListening) {\n        audioService.stop();\n      }\n    };\n  }, []);\n\n  // Función para añadir mensajes al historial de conversación\n  const addToConversation = (speaker, message) => {\n    const newMessage = {\n      id: Date.now(),\n      speaker,\n      message,\n      timestamp: new Date().toISOString()\n    };\n    \n    const updatedConversation = [...conversationRef.current, newMessage];\n    conversationRef.current = updatedConversation;\n    setConversation(updatedConversation);\n  };\n  \n  // Función para iniciar la síntesis de voz\n  const handleSpeak = () => {\n    if (!text.trim()) {\n      setStatus('El texto no puede estar vacío');\n      return;\n    }\n    \n    // Guardar la última frase para evitar repetición\n    lastUtteranceRef.current = text;\n    \n    setIsSpeaking(true);\n    setStatus('Hablando...');\n    \n    // Añadir el mensaje del sistema a la conversación\n    if (!conversation.some(item => item.message === text && item.speaker === 'system')) {\n      addToConversation('system', text);\n    }\n    \n    audioService.speakText(\n      text,\n      () => {\n        setStatus('Hablando...');\n      },\n      () => {\n        setIsSpeaking(false);\n        setStatus('Listo para escuchar');\n        // Iniciar automáticamente la escucha después de hablar\n        if (recognitionSupported && micPermission === 'granted') {\n          startVoiceRecognition();\n        } else if (recognitionSupported && micPermission === 'unknown') {\n          // Solicitar permiso si aún no se ha solicitado\n          requestMicrophonePermission();\n        }\n      },\n      (error) => {\n        setIsSpeaking(false);\n        setStatus(`Error: ${error}`);\n      }\n    );\n  };\n\n  // Función para detener la síntesis de voz\n  const handleStop = () => {\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n      setIsSpeaking(false);\n      setStatus('Síntesis detenida');\n    }\n  };\n\n  // Solicitar permiso para usar el micrófono\n  const requestMicrophonePermission = async () => {\n    setStatus('Solicitando permiso para el micrófono...');\n    const granted = await audioService.requestMicrophonePermission();\n    if (granted) {\n      setMicPermission('granted');\n      setStatus('Permiso para micrófono concedido');\n      startVoiceRecognition();\n    } else {\n      setMicPermission('denied');\n      setStatus('Se requiere permiso para el micrófono para usar esta función');\n    }\n  };\n  \n  // Simular una respuesta automática natural basada en lo que dijo el usuario\n  const getAutoResponse = (userInput) => {\n    const input = userInput.toLowerCase();\n    \n    // Respuestas comunes de conversación\n    if (input.includes('hola') || input.includes('buenos días') || input.includes('buenas tardes') || input.includes('buenas noches')) {\n      return '¡Hola! ¿Cómo estás hoy? ¿En qué puedo ayudarte?';\n    }\n    if (input.includes('cómo estás') || input.includes('como estas')) {\n      return 'Estoy muy bien, gracias por preguntar. ¿Y tú cómo estás?';\n    }\n    if (input.includes('gracias') || input.includes('te lo agradezco')) {\n      return 'De nada. Estoy aquí para ayudarte. ¿Hay algo más que necesites?';\n    }\n    if (input.includes('adiós') || input.includes('hasta luego') || input.includes('chao')) {\n      return 'Hasta luego. Fue un placer hablar contigo. ¡Que tengas un buen día!';\n    }\n    if (input.includes('bien') || input.includes('excelente') || input.includes('muy bien')) {\n      return 'Me alegra escuchar eso. ¿En qué puedo ayudarte hoy?';\n    }\n    if (input.includes('mal') || input.includes('triste') || input.includes('no muy bien')) {\n      return 'Lamento escuchar eso. Espero que tu día mejore pronto. ¿Hay algo en lo que pueda ayudarte?';\n    }\n    \n    // Respuesta genérica si no coincide con ningún patrón\n    return 'Entiendo. ¿Hay algo específico en lo que pueda ayudarte hoy?';\n  };\n\n  // Iniciar reconocimiento de voz\n  const startVoiceRecognition = async () => {\n    if (!audioService.isSupportedByBrowser()) {\n      setStatus('Tu navegador no soporta reconocimiento de voz');\n      return;\n    }\n    \n    if (micPermission !== 'granted') {\n      await requestMicrophonePermission();\n      return;\n    }\n    \n    audioService.init('es-ES');\n    \n    setRecognizedText('');\n    \n    audioService.onResult((transcript, isFinal) => {\n      setRecognizedText(transcript);\n      setStatus(isFinal ? 'Procesando...' : 'Escuchando...');\n    });\n    \n    audioService.onEnd((finalTranscript) => {\n      setIsListening(false);\n      setStatus('Procesando tu mensaje...');\n      \n      // Verificar si se reconoció algo de texto\n      if (finalTranscript && finalTranscript.trim()) {\n        // Añadir el mensaje del usuario a la conversación\n        addToConversation('user', finalTranscript);\n        \n        // Generar una respuesta automática\n        setTimeout(() => {\n          const response = getAutoResponse(finalTranscript);\n          setText(response);\n          \n          // Iniciar síntesis de voz con un pequeño retraso para simular \"pensamiento\"\n          setTimeout(handleSpeak, 500);\n        }, 1000);\n      } else {\n        setStatus('No se detectó ningún mensaje. Puedes intentarlo de nuevo.');\n      }\n    });\n    \n    audioService.onError((errorMessage) => {\n      if (errorMessage === 'no-speech') {\n        setStatus('No se detectó ninguna voz. Por favor, intenta hablar de nuevo.');\n      } else {\n        setStatus(`Error de reconocimiento: ${errorMessage}`);\n      }\n      setIsListening(false);\n    });\n    \n    try {\n      const started = await audioService.start();\n      if (started) {\n        setIsListening(true);\n        setStatus('Escuchando...');\n      } else {\n        setStatus('No se pudo iniciar el reconocimiento de voz');\n      }\n    } catch (error) {\n      setStatus(`Error al iniciar reconocimiento: ${error.message || 'Error desconocido'}`);\n    }\n  };\n\n  // Detener reconocimiento de voz\n  const stopVoiceRecognition = () => {\n    audioService.stop();\n    setIsListening(false);\n    setStatus('Reconocimiento detenido');\n  };\n\n  return (\n    <div className=\"max-w-3xl mx-auto p-6\">\n      <h1 className=\"text-3xl font-bold mb-6 text-center\">Conversación por Voz</h1>\n      \n      {/* Estado del micrófono y permisos */}\n      <div className=\"bg-white rounded-lg shadow-md p-4 mb-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-lg font-bold\">Estado del Sistema</h2>\n            <div className=\"flex flex-wrap gap-3 mt-2\">\n              <span className={`inline-block px-3 py-1 rounded-full text-sm ${speechSupported ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                {speechSupported ? '✓ Síntesis disponible' : '✗ Síntesis no disponible'}\n              </span>\n              <span className={`inline-block px-3 py-1 rounded-full text-sm ${recognitionSupported ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>\n                {recognitionSupported ? '✓ Reconocimiento disponible' : '✗ Reconocimiento no disponible'}\n              </span>\n              <span className={`inline-block px-3 py-1 rounded-full text-sm ${\n                micPermission === 'granted' ? 'bg-green-100 text-green-800' : \n                micPermission === 'denied' ? 'bg-red-100 text-red-800' : \n                'bg-yellow-100 text-yellow-800'}`}\n              >\n                {micPermission === 'granted' ? '✓ Micrófono permitido' : \n                 micPermission === 'denied' ? '✗ Micrófono bloqueado' : \n                 '? Permiso de micrófono pendiente'}\n              </span>\n            </div>\n          </div>\n          \n          {/* Botones de control */}\n          <div className=\"flex space-x-2\">\n            {micPermission !== 'granted' && (\n              <button \n                onClick={requestMicrophonePermission}\n                className=\"px-4 py-2 rounded-md bg-blue-600 hover:bg-blue-700 text-white\"\n              >\n                Permitir Micrófono\n              </button>\n            )}\n            {!isListening && micPermission === 'granted' && (\n              <button\n                onClick={startVoiceRecognition}\n                className=\"px-4 py-2 rounded-md bg-green-600 hover:bg-green-700 text-white flex items-center gap-2\"\n              >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                  <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                </svg>\n                Hablar\n              </button>\n            )}\n            {isListening && (\n              <button\n                onClick={stopVoiceRecognition}\n                className=\"px-4 py-2 rounded-md bg-red-600 hover:bg-red-700 text-white flex items-center gap-2\"\n              >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                  <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z\" clipRule=\"evenodd\" />\n                </svg>\n                Detener\n              </button>\n            )}\n          </div>\n        </div>\n      </div>\n      \n      {/* Historial de conversación */}\n      <div className=\"bg-white rounded-lg shadow-md p-6 mb-6 max-h-[400px] overflow-y-auto\">\n        <h2 className=\"text-xl font-bold mb-4\">Conversación</h2>\n        \n        {conversation.length === 0 ? (\n          <div className=\"text-center text-gray-500 py-4\">La conversación comenzará pronto...</div>\n        ) : (\n          <div className=\"space-y-4\">\n            {conversation.map((msg) => (\n              <div \n                key={msg.id} \n                className={`p-3 rounded-lg ${msg.speaker === 'system' ? 'bg-blue-50 ml-4' : 'bg-green-50 mr-4'}`}\n              >\n                <div className=\"font-semibold text-sm text-gray-600 mb-1\">\n                  {msg.speaker === 'system' ? 'Asistente' : 'Tú'}\n                </div>\n                <div>{msg.message}</div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n      \n      {/* Estado actual y texto reconocido */}\n      <div className=\"bg-gray-50 rounded-lg shadow-md p-4\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-sm font-medium text-gray-700\">\n            Estado: <span className=\"font-bold\">{status || \"Listo\"}</span>\n          </span>\n          {isListening && (\n            <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n              <span className=\"mr-1 h-2 w-2 rounded-full bg-green-500 animate-pulse\"></span>\n              Escuchando\n            </span>\n          )}\n          {isSpeaking && (\n            <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n              <span className=\"mr-1 h-2 w-2 rounded-full bg-blue-500 animate-pulse\"></span>\n              Hablando\n            </span>\n          )}\n        </div>\n        \n        {isListening && (\n          <div className=\"border border-gray-300 rounded-md p-3 bg-white\">\n            <p className=\"text-gray-700\">\n              {recognizedText || \"Esperando que hables...\"}\n            </p>\n          </div>\n        )}\n        \n        {/* SimpleVoice (oculto visualmente pero funcional) */}\n        {isSpeaking && <SimpleVoice text=\"\" />}\n      </div>\n    </div>\n  );\n};\n\nexport default VoiceTest;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}