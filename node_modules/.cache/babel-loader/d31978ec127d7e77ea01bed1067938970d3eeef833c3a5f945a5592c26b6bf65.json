{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\josep\\\\Documents\\\\Sistema de Encuestas por Voz\\\\client\\\\src\\\\pages\\\\TakeSurvey.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { SurveyService, ResponseService } from '../services/apiService';\n\n// Componentes\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport ErrorMessage from '../components/ErrorMessage';\nimport audioService from '../services/audioService';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst TakeSurvey = () => {\n  _s();\n  const {\n    surveyId\n  } = useParams();\n  const navigate = useNavigate();\n\n  // Referencias para controlar el flujo de la conversación\n  const conversationActive = useRef(false);\n  const speakTimeoutRef = useRef(null);\n\n  // Estados\n  const [survey, setSurvey] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [responses, setResponses] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [currentResponse, setCurrentResponse] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const [voiceEnabled, setVoiceEnabled] = useState(true);\n  const [conversationState, setConversationState] = useState('idle'); // idle, speaking, listening, processing\n  const [conversationMessage, setConversationMessage] = useState('');\n  const [micPermission, setMicPermission] = useState('unknown'); // 'unknown', 'granted', 'denied'\n  const [recognizedText, setRecognizedText] = useState('');\n  const [status, setStatus] = useState('');\n  const [showPermissionDialog, setShowPermissionDialog] = useState(false);\n\n  // Verificar permiso del micrófono\n  const requestMicrophonePermission = async () => {\n    setConversationState('requesting_permission');\n    setConversationMessage('Solicitando permiso para el micrófono...');\n    try {\n      const permissionGranted = await audioService.requestMicrophonePermission();\n      if (permissionGranted) {\n        setMicPermission('granted');\n        setShowPermissionDialog(false);\n        setConversationMessage('Permiso concedido. Iniciando encuesta por voz...');\n\n        // Pequeño retraso para iniciar la conversación\n        setTimeout(() => {\n          startConversation();\n        }, 1000);\n      } else {\n        setMicPermission('denied');\n        setConversationState('permission_denied');\n        setConversationMessage('Se necesita acceso al micrófono para usar la función de voz');\n      }\n    } catch (error) {\n      console.error('Error al solicitar permiso:', error);\n      setMicPermission('denied');\n      setConversationState('error');\n      setConversationMessage('Error al solicitar permiso del micrófono');\n    }\n  };\n\n  // Cargar la encuesta\n  useEffect(() => {\n    const fetchSurvey = async () => {\n      try {\n        const data = await SurveyService.getPublicSurvey(surveyId);\n        console.log('Encuesta cargada:', data);\n        setSurvey(data);\n        // Inicializar respuestas vacías\n        setResponses(new Array(data.questions.length).fill(''));\n      } catch (error) {\n        console.error('Error al cargar la encuesta:', error);\n        setError('No se pudo cargar la encuesta. Verifique que el ID sea correcto y que la encuesta esté activa.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchSurvey();\n\n    // Inicializar sistema de voz\n    audioService.initSpeechSystem();\n\n    // Configurar el callback para cambios en el permiso del micrófono\n    audioService.onPermissionChange((granted, errorMsg) => {\n      setMicPermission(granted ? 'granted' : 'denied');\n      if (!granted && errorMsg) {\n        setConversationMessage(`Error de permiso: ${errorMsg}`);\n        setConversationState('permission_denied');\n      }\n    });\n    return () => {\n      // Detener cualquier síntesis y reconocimiento al desmontar\n      if (speakTimeoutRef.current) {\n        clearTimeout(speakTimeoutRef.current);\n      }\n      audioService.stop();\n      conversationActive.current = false;\n      if (window.speechSynthesis) {\n        window.speechSynthesis.cancel();\n      }\n    };\n  }, [surveyId]);\n\n  // Iniciar la conversación una vez que la encuesta esté cargada\n  useEffect(() => {\n    if (survey && voiceEnabled && !conversationActive.current) {\n      // Primero verificar permiso de micrófono\n      if (micPermission === 'granted') {\n        startConversation();\n      } else if (micPermission === 'unknown') {\n        // Mostrar diálogo de permiso\n        setShowPermissionDialog(true);\n      }\n    }\n  }, [survey, voiceEnabled, micPermission]);\n\n  // Función para iniciar la conversación\n  const startConversation = () => {\n    if (!voiceEnabled || !survey) return;\n    conversationActive.current = true;\n\n    // Dar un mensaje de bienvenida\n    if (survey.welcomeMessage) {\n      speakText(survey.welcomeMessage, () => {\n        // Después de la bienvenida, preguntar la primera pregunta\n        speakCurrentQuestion();\n      });\n    } else {\n      // Si no hay mensaje de bienvenida, ir directamente a la primera pregunta\n      speakCurrentQuestion();\n    }\n  };\n\n  // Función para hablar el texto usando el servicio de audio\n  const speakText = (text, onEndCallback) => {\n    if (!voiceEnabled) {\n      if (onEndCallback) onEndCallback();\n      return;\n    }\n    setConversationState('speaking');\n    setConversationMessage('Hablando...');\n    audioService.speakText(text, () => {\n      console.log('Hablando:', text);\n    }, () => {\n      console.log('Terminó de hablar');\n      setConversationState('idle');\n      if (onEndCallback) {\n        // Pequeño retraso para una experiencia más natural\n        speakTimeoutRef.current = setTimeout(onEndCallback, 500);\n      }\n    }, error => {\n      console.error('Error al hablar:', error);\n      setConversationState('idle');\n      if (onEndCallback) onEndCallback();\n    });\n  };\n\n  // Función para hablar la pregunta actual\n  const speakCurrentQuestion = () => {\n    if (!survey || !voiceEnabled) return;\n    const currentQuestion = survey.questions[currentQuestionIndex];\n    if (!currentQuestion) return;\n    let questionText = `Pregunta ${currentQuestionIndex + 1}: ${currentQuestion.text}`;\n\n    // Agregar información sobre opciones si es pregunta de opción múltiple\n    if (currentQuestion.type === 'multiple_choice' && currentQuestion.options) {\n      questionText += '. Las opciones son: ';\n      questionText += currentQuestion.options.map((option, idx) => `Opción ${idx + 1}: ${option}`).join(', ');\n    }\n    speakText(questionText, () => {\n      // Después de hablar la pregunta, iniciar el reconocimiento de voz\n      startListening();\n    });\n  };\n\n  // Función para iniciar la escucha de la respuesta del usuario\n  const startListening = async () => {\n    if (!voiceEnabled) return;\n    if (!audioService.isSupportedByBrowser()) {\n      setError('Tu navegador no soporta reconocimiento de voz');\n      return;\n    }\n    if (micPermission !== 'granted') {\n      await requestMicrophonePermission();\n      return;\n    }\n    audioService.init('es-ES');\n    setRecognizedText('');\n    audioService.onResult((transcript, isFinal) => {\n      setCurrentResponse(transcript);\n      setStatus(isFinal ? 'Procesando...' : 'Escuchando...');\n    });\n    audioService.onEnd(finalTranscript => {\n      setIsListening(false);\n      setConversationState('processing');\n      setConversationMessage('Procesando respuesta...');\n\n      // Guardar la respuesta y continuar la conversación\n      handleVoiceResponse(finalTranscript);\n    });\n    audioService.onError(errorMessage => {\n      console.error('Error de reconocimiento:', errorMessage);\n      setError(`Error de reconocimiento: ${errorMessage}`);\n      setIsListening(false);\n      setConversationState('idle');\n\n      // Reintentar la escucha después de un error\n      speakTimeoutRef.current = setTimeout(() => {\n        speakText('No pude entender tu respuesta. Por favor, inténtalo de nuevo.', () => {\n          startListening();\n        });\n      }, 1000);\n    });\n    try {\n      const started = await audioService.start();\n      if (started) {\n        setIsListening(true);\n        setConversationState('listening');\n        setConversationMessage('Escuchando...');\n      } else {\n        setError('No se pudo iniciar el reconocimiento de voz');\n        setConversationState('idle');\n      }\n    } catch (error) {\n      setError(`Error al iniciar reconocimiento: ${error.message || 'Error desconocido'}`);\n      setConversationState('idle');\n    }\n  };\n\n  // Manejar la respuesta por voz\n  const handleVoiceResponse = response => {\n    if (!response || response.trim() === '') {\n      // Si no hay respuesta, pedir que repita\n      speakText('No he escuchado ninguna respuesta. Por favor, intenta de nuevo.', () => {\n        startListening();\n      });\n      return;\n    }\n\n    // Guardar la respuesta actual\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = response;\n    setResponses(updatedResponses);\n\n    // Dar feedback al usuario\n    speakText(`He registrado tu respuesta: ${response}.`, () => {\n      // Pasar a la siguiente pregunta o finalizar\n      if (currentQuestionIndex < survey.questions.length - 1) {\n        setCurrentQuestionIndex(currentQuestionIndex + 1);\n        setCurrentResponse('');\n        // Hablar la siguiente pregunta después de un breve pausa\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 1000);\n      } else {\n        // Si es la última pregunta, mostrar confirmación\n        setShowConfirmation(true);\n        speakText('Hemos terminado todas las preguntas. Ahora te mostraré un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    });\n  };\n\n  // Leer el resumen de confirmación\n  const speakConfirmationSummary = () => {\n    if (!voiceEnabled || !showConfirmation) return;\n    let summaryText = 'Resumen de tus respuestas: ';\n    survey.questions.forEach((question, index) => {\n      summaryText += `Pregunta ${index + 1}: ${question.text}. Tu respuesta: ${responses[index] || \"Sin respuesta\"}. `;\n    });\n    summaryText += '¿Deseas enviar estas respuestas o volver para revisar alguna?';\n    speakText(summaryText, () => {\n      // Escuchar confirmación del usuario\n      listenForConfirmation();\n    });\n  };\n\n  // Escuchar la confirmación del usuario\n  const listenForConfirmation = () => {\n    if (!voiceEnabled) return;\n    audioService.init('es-ES');\n    audioService.onResult((transcript, isFinal) => {\n      // Mostrar lo que está diciendo el usuario\n      setCurrentResponse(transcript);\n    });\n    audioService.onEnd(finalTranscript => {\n      setIsListening(false);\n\n      // Analizar respuesta para determinar si es confirmación o no\n      const lowerResponse = finalTranscript.toLowerCase();\n      if (lowerResponse.includes('sí') || lowerResponse.includes('si') || lowerResponse.includes('confirmar') || lowerResponse.includes('enviar') || lowerResponse.includes('aceptar') || lowerResponse.includes('está bien')) {\n        // Confirmado - enviar respuestas\n        speakText('Perfecto, enviando tus respuestas.', () => {\n          handleSubmit();\n        });\n      } else if (lowerResponse.includes('no') || lowerResponse.includes('volver') || lowerResponse.includes('revisar') || lowerResponse.includes('regresar')) {\n        // Volver a revisar\n        setShowConfirmation(false);\n        speakText('De acuerdo, volvamos a revisar las preguntas. Puedes navegar entre ellas usando los botones de anterior y siguiente.', null);\n      } else {\n        // Respuesta no clara\n        speakText('No he entendido si deseas confirmar o revisar. Por favor, dime \"confirmar\" para enviar las respuestas o \"revisar\" para volver a las preguntas.', () => {\n          listenForConfirmation();\n        });\n      }\n    });\n    audioService.onError(() => {\n      setIsListening(false);\n      speakText('Hubo un error al escuchar tu confirmación. Por favor, usa los botones en pantalla para confirmar o volver.', null);\n    });\n    audioService.start();\n    setIsListening(true);\n    setConversationState('listening');\n    setConversationMessage('Esperando confirmación...');\n  };\n\n  // Manejar el cambio de respuesta manual\n  const handleResponseChange = e => {\n    setCurrentResponse(e.target.value);\n  };\n\n  // Guardar la respuesta actual y avanzar a la siguiente pregunta manualmente\n  const handleNextQuestion = () => {\n    // Cancelar cualquier síntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = currentResponse;\n    setResponses(updatedResponses);\n    if (currentQuestionIndex < survey.questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setCurrentResponse('');\n\n      // Si está habilitada la voz, hablar la siguiente pregunta\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    } else {\n      setShowConfirmation(true);\n      if (voiceEnabled) {\n        speakText('Hemos terminado todas las preguntas. Ahora te mostraré un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    }\n  };\n\n  // Volver a la pregunta anterior manualmente\n  const handlePreviousQuestion = () => {\n    // Cancelar cualquier síntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n      setCurrentResponse(responses[currentQuestionIndex - 1]);\n\n      // Si está habilitada la voz, hablar la pregunta anterior\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    }\n  };\n\n  // Enviar todas las respuestas\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    try {\n      // Preparar objeto de respuesta\n      const responseData = {\n        surveyId: survey._id,\n        responses: survey.questions.map((question, index) => ({\n          questionId: question._id,\n          questionText: question.text,\n          responseText: responses[index] || '',\n          questionType: question.type\n        }))\n      };\n\n      // Enviar respuesta a la API\n      await ResponseService.submitResponse(responseData);\n\n      // Mensaje de despedida\n      if (voiceEnabled) {\n        speakText(survey.farewell || '¡Gracias por completar la encuesta!', () => {\n          // Redirigir a página de agradecimiento\n          navigate(`/thank-you`, {\n            state: {\n              message: survey.farewell || '¡Gracias por completar la encuesta!'\n            }\n          });\n        });\n      } else {\n        // Redirigir a página de agradecimiento sin hablar\n        navigate(`/thank-you`, {\n          state: {\n            message: survey.farewell || '¡Gracias por completar la encuesta!'\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error al enviar respuestas:', error);\n      setError('Ocurrió un error al enviar tus respuestas. Por favor, intenta nuevamente.');\n      setIsSubmitting(false);\n      if (voiceEnabled) {\n        speakText('Ha ocurrido un error al enviar tus respuestas. Por favor, intenta nuevamente.', null);\n      }\n    }\n  };\n\n  // Iniciar reconocimiento de voz manual\n  const startVoiceRecognition = () => {\n    if (isListening) return;\n\n    // Cancelar cualquier síntesis en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    startListening();\n  };\n\n  // Detener reconocimiento de voz manual\n  const stopVoiceRecognition = () => {\n    audioService.stop();\n    setIsListening(false);\n    setConversationState('idle');\n  };\n\n  // Alternar el uso de voz\n  const toggleVoice = () => {\n    // Cancelar cualquier síntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    const newVoiceEnabled = !voiceEnabled;\n    setVoiceEnabled(newVoiceEnabled);\n    if (newVoiceEnabled && !conversationActive.current) {\n      // Si se activa la voz, iniciar conversación\n      conversationActive.current = false; // Reset para que startConversation funcione\n      startConversation();\n    }\n  };\n\n  // Renderizar pantalla de carga\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(LoadingSpinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 512,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Renderizar mensaje de error\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(ErrorMessage, {\n      message: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 517,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Si no hay encuesta\n  if (!survey) {\n    return /*#__PURE__*/_jsxDEV(ErrorMessage, {\n      message: \"No se encontr\\xF3 la encuesta solicitada.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 522,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Obtener la pregunta actual\n  const currentQuestion = survey.questions[currentQuestionIndex];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-end mb-2\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: toggleVoice,\n        className: `px-3 py-1 rounded text-sm ${voiceEnabled ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-700'}`,\n        children: voiceEnabled ? '🔊 Voz Activada' : '🔇 Voz Desactivada'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 532,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 531,\n      columnNumber: 7\n    }, this), showPermissionDialog && micPermission === 'unknown' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-lg shadow-xl p-6 max-w-md mx-auto\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-4 text-center\",\n          children: \"Permiso para usar el micr\\xF3fono\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mb-4\",\n          children: \"Esta encuesta utiliza reconocimiento de voz para una experiencia m\\xE1s natural. Para continuar, necesitamos tu permiso para acceder al micr\\xF3fono.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 545,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex flex-col gap-3 mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: requestMicrophonePermission,\n            className: \"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center gap-2\",\n            children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              className: \"h-5 w-5\",\n              viewBox: \"0 0 20 20\",\n              fill: \"currentColor\",\n              children: /*#__PURE__*/_jsxDEV(\"path\", {\n                fillRule: \"evenodd\",\n                d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                clipRule: \"evenodd\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 555,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 554,\n              columnNumber: 17\n            }, this), \"Permitir micr\\xF3fono\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 550,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => {\n              setShowPermissionDialog(false);\n              setVoiceEnabled(false);\n              setMicPermission('denied');\n            },\n            className: \"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300\",\n            children: \"Continuar sin voz\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 559,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 549,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 542,\n      columnNumber: 9\n    }, this), voiceEnabled && conversationState !== 'idle' && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `mb-4 p-3 rounded-lg shadow-sm text-center ${conversationState === 'speaking' ? 'bg-blue-100 text-blue-700' : conversationState === 'listening' ? 'bg-green-100 text-green-700' : conversationState === 'requesting_permission' ? 'bg-purple-100 text-purple-700' : conversationState === 'permission_denied' ? 'bg-red-100 text-red-700' : 'bg-yellow-100 text-yellow-700'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"font-semibold flex items-center justify-center gap-2\",\n        children: [conversationState === 'speaking' && /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"inline-flex justify-center items-center\",\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"h-2 w-2 bg-blue-600 rounded-full animate-ping mr-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 586,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"h-2 w-2 bg-blue-600 rounded-full animate-ping mx-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 587,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"h-2 w-2 bg-blue-600 rounded-full animate-ping ml-1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 588,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 585,\n          columnNumber: 15\n        }, this), conversationState === 'listening' && /*#__PURE__*/_jsxDEV(\"svg\", {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          className: \"h-5 w-5 animate-pulse\",\n          viewBox: \"0 0 20 20\",\n          fill: \"currentColor\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            fillRule: \"evenodd\",\n            d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n            clipRule: \"evenodd\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 593,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 592,\n          columnNumber: 15\n        }, this), conversationMessage]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 583,\n        columnNumber: 11\n      }, this), isListening && /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-sm mt-2 text-green-700\",\n        children: \"Escuch\\xE1ndote... habla claramente cuando escuches el tono.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 599,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 576,\n      columnNumber: 9\n    }, this), micPermission === 'denied' && voiceEnabled && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-4 p-3 rounded-lg bg-red-50 border border-red-200\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-red-700 flex items-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          className: \"h-5 w-5 mr-2\",\n          viewBox: \"0 0 20 20\",\n          fill: \"currentColor\",\n          children: /*#__PURE__*/_jsxDEV(\"path\", {\n            fillRule: \"evenodd\",\n            d: \"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\",\n            clipRule: \"evenodd\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 609,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 608,\n          columnNumber: 13\n        }, this), \"Se necesita acceso al micr\\xF3fono para usar la funcionalidad de voz.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 607,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-2 flex justify-end\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: requestMicrophonePermission,\n          className: \"text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700\",\n          children: \"Reintentar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setVoiceEnabled(false),\n          className: \"text-sm px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 ml-2\",\n          children: \"Continuar sin voz\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 620,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 613,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 606,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-8 text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-3xl font-bold mb-2\",\n        children: survey.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 632,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-600\",\n        children: survey.description\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 633,\n        columnNumber: 9\n      }, this), currentQuestionIndex === 0 && survey.welcomeMessage && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-4 p-4 bg-blue-50 rounded-lg\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: survey.welcomeMessage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 636,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 635,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 631,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full bg-gray-200 rounded-full h-2.5\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"bg-blue-600 h-2.5 rounded-full\",\n          style: {\n            width: `${(currentQuestionIndex + 1) / survey.questions.length * 100}%`\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 644,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 643,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-right text-sm mt-1\",\n        children: [\"Pregunta \", currentQuestionIndex + 1, \" de \", survey.questions.length]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 649,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 642,\n      columnNumber: 7\n    }, this), showConfirmation ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-white rounded-lg shadow-lg p-6\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        className: \"text-2xl font-bold mb-4\",\n        children: \"Confirmar env\\xEDo\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 657,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mb-4\",\n        children: \"\\xBFEst\\xE1s seguro de que deseas enviar tus respuestas?\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 658,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"font-bold mb-2\",\n          children: \"Resumen de respuestas:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 661,\n          columnNumber: 13\n        }, this), survey.questions.map((question, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-3\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"font-medium\",\n            children: [index + 1, \". \", question.text]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 664,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-gray-700 pl-4\",\n            children: responses[index] || \"(Sin respuesta)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 665,\n            columnNumber: 17\n          }, this)]\n        }, question._id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 663,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 660,\n        columnNumber: 11\n      }, this), isListening && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-green-100 p-3 rounded mb-4 animate-pulse\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-center text-green-800\",\n          children: \"\\uD83C\\uDFA4 Di \\\"confirmar\\\" para enviar o \\\"revisar\\\" para volver\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 672,\n          columnNumber: 15\n        }, this), currentResponse && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm italic text-center mt-1\",\n          children: [\"\\\"\", currentResponse, \"\\\"\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 676,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 671,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            setShowConfirmation(false);\n            if (voiceEnabled) {\n              speakText('Volvamos a revisar las preguntas.', null);\n            }\n          },\n          className: \"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300\",\n          disabled: isSubmitting,\n          children: \"Volver\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 682,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSubmit,\n          className: \"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\",\n          disabled: isSubmitting,\n          children: isSubmitting ? 'Enviando...' : 'Confirmar envío'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 694,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 681,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 656,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-lg shadow-lg p-6 mb-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-xl font-bold mb-4\",\n          children: currentQuestion.text\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 706,\n          columnNumber: 13\n        }, this), currentQuestion.type === 'multiple_choice' && currentQuestion.options && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"text-sm text-gray-600 mb-2\",\n            children: \"Opciones:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 711,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            className: \"list-disc pl-5\",\n            children: currentQuestion.options.map((option, idx) => /*#__PURE__*/_jsxDEV(\"li\", {\n              className: \"mb-1\",\n              children: option\n            }, idx, false, {\n              fileName: _jsxFileName,\n              lineNumber: 714,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 712,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 710,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"label\", {\n            className: \"block text-sm font-medium text-gray-700 mb-1\",\n            children: \"Tu respuesta:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 722,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n            value: currentResponse,\n            onChange: handleResponseChange,\n            className: \"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\",\n            rows: \"3\",\n            placeholder: \"Escribe tu respuesta...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 725,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex items-center mt-2\",\n            children: [voiceEnabled && micPermission === 'granted' && !isListening ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: startVoiceRecognition,\n              className: \"flex items-center px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 741,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 740,\n                columnNumber: 21\n              }, this), \"Responder por voz\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 736,\n              columnNumber: 19\n            }, this) : voiceEnabled && micPermission === 'granted' && isListening ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: stopVoiceRecognition,\n              className: \"flex items-center px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 shadow-sm animate-pulse\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 751,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 750,\n                columnNumber: 21\n              }, this), \"Detener grabaci\\xF3n\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 746,\n              columnNumber: 19\n            }, this) : voiceEnabled && micPermission === 'unknown' ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: requestMicrophonePermission,\n              className: \"flex items-center px-3 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  d: \"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 761,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 760,\n                columnNumber: 21\n              }, this), \"Permitir micr\\xF3fono\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 756,\n              columnNumber: 19\n            }, this) : voiceEnabled && micPermission === 'denied' ? /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: requestMicrophonePermission,\n              className: \"flex items-center px-3 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 shadow-sm border border-red-300\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 771,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 770,\n                columnNumber: 21\n              }, this), \"Micr\\xF3fono bloqueado\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 766,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => {\n                setVoiceEnabled(true);\n                requestMicrophonePermission();\n              },\n              className: \"flex items-center px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 shadow-sm\",\n              children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n                xmlns: \"http://www.w3.org/2000/svg\",\n                className: \"h-5 w-5 mr-2\",\n                viewBox: \"0 0 20 20\",\n                fill: \"currentColor\",\n                children: /*#__PURE__*/_jsxDEV(\"path\", {\n                  fillRule: \"evenodd\",\n                  d: \"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\",\n                  clipRule: \"evenodd\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 784,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 783,\n                columnNumber: 21\n              }, this), \"Activar modo voz\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 776,\n              columnNumber: 19\n            }, this), isListening && /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"ml-2 text-green-600 flex items-center animate-pulse\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"w-2 h-2 bg-green-600 rounded-full mr-1 animate-ping\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 792,\n                columnNumber: 21\n              }, this), \"Escuchando...\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 791,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 734,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 705,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-between\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handlePreviousQuestion,\n          disabled: currentQuestionIndex === 0,\n          className: `px-4 py-2 rounded ${currentQuestionIndex === 0 ? 'bg-gray-200 text-gray-400 cursor-not-allowed' : 'bg-gray-200 text-gray-800 hover:bg-gray-300'}`,\n          children: \"Anterior\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 802,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleNextQuestion,\n          className: \"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\",\n          children: currentQuestionIndex < survey.questions.length - 1 ? 'Siguiente' : 'Finalizar'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 814,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 801,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 529,\n    columnNumber: 5\n  }, this);\n};\n_s(TakeSurvey, \"/Q0DyABdRa+LNpr9Mnmxkw4ETzI=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = TakeSurvey;\nexport default TakeSurvey;\nvar _c;\n$RefreshReg$(_c, \"TakeSurvey\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","SurveyService","ResponseService","LoadingSpinner","ErrorMessage","audioService","jsxDEV","_jsxDEV","Fragment","_Fragment","TakeSurvey","_s","surveyId","navigate","conversationActive","speakTimeoutRef","survey","setSurvey","loading","setLoading","error","setError","currentQuestionIndex","setCurrentQuestionIndex","responses","setResponses","isSubmitting","setIsSubmitting","showConfirmation","setShowConfirmation","currentResponse","setCurrentResponse","isListening","setIsListening","voiceEnabled","setVoiceEnabled","conversationState","setConversationState","conversationMessage","setConversationMessage","micPermission","setMicPermission","recognizedText","setRecognizedText","status","setStatus","showPermissionDialog","setShowPermissionDialog","requestMicrophonePermission","permissionGranted","setTimeout","startConversation","console","fetchSurvey","data","getPublicSurvey","log","Array","questions","length","fill","initSpeechSystem","onPermissionChange","granted","errorMsg","current","clearTimeout","stop","window","speechSynthesis","cancel","welcomeMessage","speakText","speakCurrentQuestion","text","onEndCallback","currentQuestion","questionText","type","options","map","option","idx","join","startListening","isSupportedByBrowser","init","onResult","transcript","isFinal","onEnd","finalTranscript","handleVoiceResponse","onError","errorMessage","started","start","message","response","trim","updatedResponses","speakConfirmationSummary","summaryText","forEach","question","index","listenForConfirmation","lowerResponse","toLowerCase","includes","handleSubmit","handleResponseChange","e","target","value","handleNextQuestion","handlePreviousQuestion","responseData","_id","questionId","responseText","questionType","submitResponse","farewell","state","startVoiceRecognition","stopVoiceRecognition","toggleVoice","newVoiceEnabled","fileName","_jsxFileName","lineNumber","columnNumber","className","children","onClick","xmlns","viewBox","fillRule","d","clipRule","title","description","style","width","disabled","onChange","rows","placeholder","_c","$RefreshReg$"],"sources":["C:/Users/josep/Documents/Sistema de Encuestas por Voz/client/src/pages/TakeSurvey.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { SurveyService, ResponseService } from '../services/apiService';\n\n// Componentes\nimport LoadingSpinner from '../components/LoadingSpinner';\nimport ErrorMessage from '../components/ErrorMessage';\nimport audioService from '../services/audioService';\n\nconst TakeSurvey = () => {\n  const { surveyId } = useParams();\n  const navigate = useNavigate();\n  \n  // Referencias para controlar el flujo de la conversación\n  const conversationActive = useRef(false);\n  const speakTimeoutRef = useRef(null);\n  \n  // Estados\n  const [survey, setSurvey] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [responses, setResponses] = useState([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [currentResponse, setCurrentResponse] = useState('');\n  const [isListening, setIsListening] = useState(false);\n  const [voiceEnabled, setVoiceEnabled] = useState(true);\n  const [conversationState, setConversationState] = useState('idle'); // idle, speaking, listening, processing\n  const [conversationMessage, setConversationMessage] = useState('');\n  const [micPermission, setMicPermission] = useState('unknown'); // 'unknown', 'granted', 'denied'\n  const [recognizedText, setRecognizedText] = useState('');\n  const [status, setStatus] = useState('');\n  const [showPermissionDialog, setShowPermissionDialog] = useState(false);\n  \n  // Verificar permiso del micrófono\n  const requestMicrophonePermission = async () => {\n    setConversationState('requesting_permission');\n    setConversationMessage('Solicitando permiso para el micrófono...');\n    \n    try {\n      const permissionGranted = await audioService.requestMicrophonePermission();\n      \n      if (permissionGranted) {\n        setMicPermission('granted');\n        setShowPermissionDialog(false);\n        setConversationMessage('Permiso concedido. Iniciando encuesta por voz...');\n        \n        // Pequeño retraso para iniciar la conversación\n        setTimeout(() => {\n          startConversation();\n        }, 1000);\n      } else {\n        setMicPermission('denied');\n        setConversationState('permission_denied');\n        setConversationMessage('Se necesita acceso al micrófono para usar la función de voz');\n      }\n    } catch (error) {\n      console.error('Error al solicitar permiso:', error);\n      setMicPermission('denied');\n      setConversationState('error');\n      setConversationMessage('Error al solicitar permiso del micrófono');\n    }\n  };\n\n  // Cargar la encuesta\n  useEffect(() => {\n    const fetchSurvey = async () => {\n      try {\n        const data = await SurveyService.getPublicSurvey(surveyId);\n        console.log('Encuesta cargada:', data);\n        setSurvey(data);\n        // Inicializar respuestas vacías\n        setResponses(new Array(data.questions.length).fill(''));\n      } catch (error) {\n        console.error('Error al cargar la encuesta:', error);\n        setError('No se pudo cargar la encuesta. Verifique que el ID sea correcto y que la encuesta esté activa.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    fetchSurvey();\n    \n    // Inicializar sistema de voz\n    audioService.initSpeechSystem();\n    \n    // Configurar el callback para cambios en el permiso del micrófono\n    audioService.onPermissionChange((granted, errorMsg) => {\n      setMicPermission(granted ? 'granted' : 'denied');\n      if (!granted && errorMsg) {\n        setConversationMessage(`Error de permiso: ${errorMsg}`);\n        setConversationState('permission_denied');\n      }\n    });\n    \n    return () => {\n      // Detener cualquier síntesis y reconocimiento al desmontar\n      if (speakTimeoutRef.current) {\n        clearTimeout(speakTimeoutRef.current);\n      }\n      audioService.stop();\n      conversationActive.current = false;\n      \n      if (window.speechSynthesis) {\n        window.speechSynthesis.cancel();\n      }\n    };\n  }, [surveyId]);\n  \n  // Iniciar la conversación una vez que la encuesta esté cargada\n  useEffect(() => {\n    if (survey && voiceEnabled && !conversationActive.current) {\n      // Primero verificar permiso de micrófono\n      if (micPermission === 'granted') {\n        startConversation();\n      } else if (micPermission === 'unknown') {\n        // Mostrar diálogo de permiso\n        setShowPermissionDialog(true);\n      }\n    }\n  }, [survey, voiceEnabled, micPermission]);\n  \n  // Función para iniciar la conversación\n  const startConversation = () => {\n    if (!voiceEnabled || !survey) return;\n    \n    conversationActive.current = true;\n    \n    // Dar un mensaje de bienvenida\n    if (survey.welcomeMessage) {\n      speakText(survey.welcomeMessage, () => {\n        // Después de la bienvenida, preguntar la primera pregunta\n        speakCurrentQuestion();\n      });\n    } else {\n      // Si no hay mensaje de bienvenida, ir directamente a la primera pregunta\n      speakCurrentQuestion();\n    }\n  };\n  \n  // Función para hablar el texto usando el servicio de audio\n  const speakText = (text, onEndCallback) => {\n    if (!voiceEnabled) {\n      if (onEndCallback) onEndCallback();\n      return;\n    }\n    \n    setConversationState('speaking');\n    setConversationMessage('Hablando...');\n    \n    audioService.speakText(\n      text,\n      () => {\n        console.log('Hablando:', text);\n      },\n      () => {\n        console.log('Terminó de hablar');\n        setConversationState('idle');\n        if (onEndCallback) {\n          // Pequeño retraso para una experiencia más natural\n          speakTimeoutRef.current = setTimeout(onEndCallback, 500);\n        }\n      },\n      (error) => {\n        console.error('Error al hablar:', error);\n        setConversationState('idle');\n        if (onEndCallback) onEndCallback();\n      }\n    );\n  };\n  \n  // Función para hablar la pregunta actual\n  const speakCurrentQuestion = () => {\n    if (!survey || !voiceEnabled) return;\n    \n    const currentQuestion = survey.questions[currentQuestionIndex];\n    if (!currentQuestion) return;\n    \n    let questionText = `Pregunta ${currentQuestionIndex + 1}: ${currentQuestion.text}`;\n    \n    // Agregar información sobre opciones si es pregunta de opción múltiple\n    if (currentQuestion.type === 'multiple_choice' && currentQuestion.options) {\n      questionText += '. Las opciones son: ';\n      questionText += currentQuestion.options.map((option, idx) => \n        `Opción ${idx + 1}: ${option}`\n      ).join(', ');\n    }\n    \n    speakText(questionText, () => {\n      // Después de hablar la pregunta, iniciar el reconocimiento de voz\n      startListening();\n    });\n  };\n  \n  // Función para iniciar la escucha de la respuesta del usuario\n  const startListening = async () => {\n    if (!voiceEnabled) return;\n    \n    if (!audioService.isSupportedByBrowser()) {\n      setError('Tu navegador no soporta reconocimiento de voz');\n      return;\n    }\n    \n    if (micPermission !== 'granted') {\n      await requestMicrophonePermission();\n      return;\n    }\n    \n    audioService.init('es-ES');\n    \n    setRecognizedText('');\n    \n    audioService.onResult((transcript, isFinal) => {\n      setCurrentResponse(transcript);\n      setStatus(isFinal ? 'Procesando...' : 'Escuchando...');\n    });\n    \n    audioService.onEnd((finalTranscript) => {\n      setIsListening(false);\n      setConversationState('processing');\n      setConversationMessage('Procesando respuesta...');\n      \n      // Guardar la respuesta y continuar la conversación\n      handleVoiceResponse(finalTranscript);\n    });\n    \n    audioService.onError((errorMessage) => {\n      console.error('Error de reconocimiento:', errorMessage);\n      setError(`Error de reconocimiento: ${errorMessage}`);\n      setIsListening(false);\n      setConversationState('idle');\n      \n      // Reintentar la escucha después de un error\n      speakTimeoutRef.current = setTimeout(() => {\n        speakText('No pude entender tu respuesta. Por favor, inténtalo de nuevo.', () => {\n          startListening();\n        });\n      }, 1000);\n    });\n    \n    try {\n      const started = await audioService.start();\n      if (started) {\n        setIsListening(true);\n        setConversationState('listening');\n        setConversationMessage('Escuchando...');\n      } else {\n        setError('No se pudo iniciar el reconocimiento de voz');\n        setConversationState('idle');\n      }\n    } catch (error) {\n      setError(`Error al iniciar reconocimiento: ${error.message || 'Error desconocido'}`);\n      setConversationState('idle');\n    }\n  };\n  \n  // Manejar la respuesta por voz\n  const handleVoiceResponse = (response) => {\n    if (!response || response.trim() === '') {\n      // Si no hay respuesta, pedir que repita\n      speakText('No he escuchado ninguna respuesta. Por favor, intenta de nuevo.', () => {\n        startListening();\n      });\n      return;\n    }\n    \n    // Guardar la respuesta actual\n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = response;\n    setResponses(updatedResponses);\n    \n    // Dar feedback al usuario\n    speakText(`He registrado tu respuesta: ${response}.`, () => {\n      // Pasar a la siguiente pregunta o finalizar\n      if (currentQuestionIndex < survey.questions.length - 1) {\n        setCurrentQuestionIndex(currentQuestionIndex + 1);\n        setCurrentResponse('');\n        // Hablar la siguiente pregunta después de un breve pausa\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 1000);\n      } else {\n        // Si es la última pregunta, mostrar confirmación\n        setShowConfirmation(true);\n        speakText('Hemos terminado todas las preguntas. Ahora te mostraré un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    });\n  };\n  \n  // Leer el resumen de confirmación\n  const speakConfirmationSummary = () => {\n    if (!voiceEnabled || !showConfirmation) return;\n    \n    let summaryText = 'Resumen de tus respuestas: ';\n    \n    survey.questions.forEach((question, index) => {\n      summaryText += `Pregunta ${index + 1}: ${question.text}. Tu respuesta: ${responses[index] || \"Sin respuesta\"}. `;\n    });\n    \n    summaryText += '¿Deseas enviar estas respuestas o volver para revisar alguna?';\n    \n    speakText(summaryText, () => {\n      // Escuchar confirmación del usuario\n      listenForConfirmation();\n    });\n  };\n  \n  // Escuchar la confirmación del usuario\n  const listenForConfirmation = () => {\n    if (!voiceEnabled) return;\n    \n    audioService.init('es-ES');\n    \n    audioService.onResult((transcript, isFinal) => {\n      // Mostrar lo que está diciendo el usuario\n      setCurrentResponse(transcript);\n    });\n    \n    audioService.onEnd((finalTranscript) => {\n      setIsListening(false);\n      \n      // Analizar respuesta para determinar si es confirmación o no\n      const lowerResponse = finalTranscript.toLowerCase();\n      if (\n        lowerResponse.includes('sí') || \n        lowerResponse.includes('si') || \n        lowerResponse.includes('confirmar') || \n        lowerResponse.includes('enviar') ||\n        lowerResponse.includes('aceptar') ||\n        lowerResponse.includes('está bien')\n      ) {\n        // Confirmado - enviar respuestas\n        speakText('Perfecto, enviando tus respuestas.', () => {\n          handleSubmit();\n        });\n      } else if (\n        lowerResponse.includes('no') || \n        lowerResponse.includes('volver') || \n        lowerResponse.includes('revisar') ||\n        lowerResponse.includes('regresar')\n      ) {\n        // Volver a revisar\n        setShowConfirmation(false);\n        speakText('De acuerdo, volvamos a revisar las preguntas. Puedes navegar entre ellas usando los botones de anterior y siguiente.', null);\n      } else {\n        // Respuesta no clara\n        speakText('No he entendido si deseas confirmar o revisar. Por favor, dime \"confirmar\" para enviar las respuestas o \"revisar\" para volver a las preguntas.', () => {\n          listenForConfirmation();\n        });\n      }\n    });\n    \n    audioService.onError(() => {\n      setIsListening(false);\n      speakText('Hubo un error al escuchar tu confirmación. Por favor, usa los botones en pantalla para confirmar o volver.', null);\n    });\n    \n    audioService.start();\n    setIsListening(true);\n    setConversationState('listening');\n    setConversationMessage('Esperando confirmación...');\n  };\n  \n  // Manejar el cambio de respuesta manual\n  const handleResponseChange = (e) => {\n    setCurrentResponse(e.target.value);\n  };\n  \n  // Guardar la respuesta actual y avanzar a la siguiente pregunta manualmente\n  const handleNextQuestion = () => {\n    // Cancelar cualquier síntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    \n    const updatedResponses = [...responses];\n    updatedResponses[currentQuestionIndex] = currentResponse;\n    setResponses(updatedResponses);\n    \n    if (currentQuestionIndex < survey.questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setCurrentResponse('');\n      \n      // Si está habilitada la voz, hablar la siguiente pregunta\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    } else {\n      setShowConfirmation(true);\n      if (voiceEnabled) {\n        speakText('Hemos terminado todas las preguntas. Ahora te mostraré un resumen de tus respuestas para que las confirmes.', () => {\n          speakConfirmationSummary();\n        });\n      }\n    }\n  };\n  \n  // Volver a la pregunta anterior manualmente\n  const handlePreviousQuestion = () => {\n    // Cancelar cualquier síntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    \n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex(currentQuestionIndex - 1);\n      setCurrentResponse(responses[currentQuestionIndex - 1]);\n      \n      // Si está habilitada la voz, hablar la pregunta anterior\n      if (voiceEnabled) {\n        speakTimeoutRef.current = setTimeout(() => {\n          speakCurrentQuestion();\n        }, 500);\n      }\n    }\n  };\n  \n  // Enviar todas las respuestas\n  const handleSubmit = async () => {\n    setIsSubmitting(true);\n    \n    try {\n      // Preparar objeto de respuesta\n      const responseData = {\n        surveyId: survey._id,\n        responses: survey.questions.map((question, index) => ({\n          questionId: question._id,\n          questionText: question.text,\n          responseText: responses[index] || '',\n          questionType: question.type\n        }))\n      };\n      \n      // Enviar respuesta a la API\n      await ResponseService.submitResponse(responseData);\n      \n      // Mensaje de despedida\n      if (voiceEnabled) {\n        speakText(survey.farewell || '¡Gracias por completar la encuesta!', () => {\n          // Redirigir a página de agradecimiento\n          navigate(`/thank-you`, { \n            state: { \n              message: survey.farewell || '¡Gracias por completar la encuesta!' \n            } \n          });\n        });\n      } else {\n        // Redirigir a página de agradecimiento sin hablar\n        navigate(`/thank-you`, { \n          state: { \n            message: survey.farewell || '¡Gracias por completar la encuesta!' \n          } \n        });\n      }\n    } catch (error) {\n      console.error('Error al enviar respuestas:', error);\n      setError('Ocurrió un error al enviar tus respuestas. Por favor, intenta nuevamente.');\n      setIsSubmitting(false);\n      \n      if (voiceEnabled) {\n        speakText('Ha ocurrido un error al enviar tus respuestas. Por favor, intenta nuevamente.', null);\n      }\n    }\n  };\n  \n  // Iniciar reconocimiento de voz manual\n  const startVoiceRecognition = () => {\n    if (isListening) return;\n    \n    // Cancelar cualquier síntesis en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    \n    startListening();\n  };\n  \n  // Detener reconocimiento de voz manual\n  const stopVoiceRecognition = () => {\n    audioService.stop();\n    setIsListening(false);\n    setConversationState('idle');\n  };\n  \n  // Alternar el uso de voz\n  const toggleVoice = () => {\n    // Cancelar cualquier síntesis o reconocimiento en curso\n    if (window.speechSynthesis) {\n      window.speechSynthesis.cancel();\n    }\n    audioService.stop();\n    \n    const newVoiceEnabled = !voiceEnabled;\n    setVoiceEnabled(newVoiceEnabled);\n    \n    if (newVoiceEnabled && !conversationActive.current) {\n      // Si se activa la voz, iniciar conversación\n      conversationActive.current = false; // Reset para que startConversation funcione\n      startConversation();\n    }\n  };\n  \n  // Renderizar pantalla de carga\n  if (loading) {\n    return <LoadingSpinner />;\n  }\n  \n  // Renderizar mensaje de error\n  if (error) {\n    return <ErrorMessage message={error} />;\n  }\n  \n  // Si no hay encuesta\n  if (!survey) {\n    return <ErrorMessage message=\"No se encontró la encuesta solicitada.\" />;\n  }\n  \n  // Obtener la pregunta actual\n  const currentQuestion = survey.questions[currentQuestionIndex];\n  \n  return (\n    <div className=\"max-w-3xl mx-auto p-4\">\n      {/* Control de voz */}\n      <div className=\"flex justify-end mb-2\">\n        <button \n          onClick={toggleVoice} \n          className={`px-3 py-1 rounded text-sm ${voiceEnabled ? 'bg-blue-500 text-white' : 'bg-gray-300 text-gray-700'}`}\n        >\n          {voiceEnabled ? '🔊 Voz Activada' : '🔇 Voz Desactivada'}\n        </button>\n      </div>\n      \n      {/* Diálogo de permisos del micrófono */}\n      {showPermissionDialog && micPermission === 'unknown' && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg shadow-xl p-6 max-w-md mx-auto\">\n            <h2 className=\"text-xl font-bold mb-4 text-center\">Permiso para usar el micrófono</h2>\n            <p className=\"mb-4\">\n              Esta encuesta utiliza reconocimiento de voz para una experiencia más natural. \n              Para continuar, necesitamos tu permiso para acceder al micrófono.\n            </p>\n            <div className=\"flex flex-col gap-3 mt-6\">\n              <button\n                onClick={requestMicrophonePermission}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center justify-center gap-2\"\n              >\n                <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                  <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                </svg>\n                Permitir micrófono\n              </button>\n              <button\n                onClick={() => {\n                  setShowPermissionDialog(false);\n                  setVoiceEnabled(false);\n                  setMicPermission('denied');\n                }}\n                className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300\"\n              >\n                Continuar sin voz\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Estado de la conversación */}\n      {voiceEnabled && conversationState !== 'idle' && (\n        <div className={`mb-4 p-3 rounded-lg shadow-sm text-center ${\n          conversationState === 'speaking' ? 'bg-blue-100 text-blue-700' : \n          conversationState === 'listening' ? 'bg-green-100 text-green-700' : \n          conversationState === 'requesting_permission' ? 'bg-purple-100 text-purple-700' :\n          conversationState === 'permission_denied' ? 'bg-red-100 text-red-700' :\n          'bg-yellow-100 text-yellow-700'\n        }`}>\n          <p className=\"font-semibold flex items-center justify-center gap-2\">\n            {conversationState === 'speaking' && (\n              <span className=\"inline-flex justify-center items-center\">\n                <span className=\"h-2 w-2 bg-blue-600 rounded-full animate-ping mr-1\"></span>\n                <span className=\"h-2 w-2 bg-blue-600 rounded-full animate-ping mx-1\"></span>\n                <span className=\"h-2 w-2 bg-blue-600 rounded-full animate-ping ml-1\"></span>\n              </span>\n            )}\n            {conversationState === 'listening' && (\n              <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 animate-pulse\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n              </svg>\n            )}\n            {conversationMessage}\n          </p>\n          {isListening && (\n            <p className=\"text-sm mt-2 text-green-700\">Escuchándote... habla claramente cuando escuches el tono.</p>\n          )}\n        </div>\n      )}\n      \n      {/* Mensaje de error de permisos */}\n      {micPermission === 'denied' && voiceEnabled && (\n        <div className=\"mb-4 p-3 rounded-lg bg-red-50 border border-red-200\">\n          <p className=\"text-red-700 flex items-center\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n              <path fillRule=\"evenodd\" d=\"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z\" clipRule=\"evenodd\" />\n            </svg>\n            Se necesita acceso al micrófono para usar la funcionalidad de voz.\n          </p>\n          <div className=\"mt-2 flex justify-end\">\n            <button \n              onClick={requestMicrophonePermission}\n              className=\"text-sm px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700\"\n            >\n              Reintentar\n            </button>\n            <button \n              onClick={() => setVoiceEnabled(false)}\n              className=\"text-sm px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 ml-2\"\n            >\n              Continuar sin voz\n            </button>\n          </div>\n        </div>\n      )}\n      \n      {/* Encabezado de la encuesta */}\n      <div className=\"mb-8 text-center\">\n        <h1 className=\"text-3xl font-bold mb-2\">{survey.title}</h1>\n        <p className=\"text-gray-600\">{survey.description}</p>\n        {currentQuestionIndex === 0 && survey.welcomeMessage && (\n          <div className=\"mt-4 p-4 bg-blue-50 rounded-lg\">\n            <p>{survey.welcomeMessage}</p>\n          </div>\n        )}\n      </div>\n      \n      {/* Progreso */}\n      <div className=\"mb-6\">\n        <div className=\"w-full bg-gray-200 rounded-full h-2.5\">\n          <div \n            className=\"bg-blue-600 h-2.5 rounded-full\" \n            style={{ width: `${((currentQuestionIndex + 1) / survey.questions.length) * 100}%` }}\n          ></div>\n        </div>\n        <p className=\"text-right text-sm mt-1\">\n          Pregunta {currentQuestionIndex + 1} de {survey.questions.length}\n        </p>\n      </div>\n      \n      {/* Pantalla de confirmación */}\n      {showConfirmation ? (\n        <div className=\"bg-white rounded-lg shadow-lg p-6\">\n          <h2 className=\"text-2xl font-bold mb-4\">Confirmar envío</h2>\n          <p className=\"mb-4\">¿Estás seguro de que deseas enviar tus respuestas?</p>\n          \n          <div className=\"mb-6\">\n            <h3 className=\"font-bold mb-2\">Resumen de respuestas:</h3>\n            {survey.questions.map((question, index) => (\n              <div key={question._id} className=\"mb-3\">\n                <p className=\"font-medium\">{index + 1}. {question.text}</p>\n                <p className=\"text-gray-700 pl-4\">{responses[index] || \"(Sin respuesta)\"}</p>\n              </div>\n            ))}\n          </div>\n          \n          {isListening && (\n            <div className=\"bg-green-100 p-3 rounded mb-4 animate-pulse\">\n              <p className=\"text-center text-green-800\">\n                🎤 Di \"confirmar\" para enviar o \"revisar\" para volver\n              </p>\n              {currentResponse && (\n                <p className=\"text-sm italic text-center mt-1\">\"{currentResponse}\"</p>\n              )}\n            </div>\n          )}\n          \n          <div className=\"flex justify-between\">\n            <button\n              onClick={() => {\n                setShowConfirmation(false);\n                if (voiceEnabled) {\n                  speakText('Volvamos a revisar las preguntas.', null);\n                }\n              }}\n              className=\"px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300\"\n              disabled={isSubmitting}\n            >\n              Volver\n            </button>\n            <button\n              onClick={handleSubmit}\n              className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\"\n              disabled={isSubmitting}\n            >\n              {isSubmitting ? 'Enviando...' : 'Confirmar envío'}\n            </button>\n          </div>\n        </div>      ) : (\n        <>\n          {/* Pregunta actual */}\n          <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n            <h2 className=\"text-xl font-bold mb-4\">{currentQuestion.text}</h2>\n            \n            {/* Opciones para preguntas de tipo opción */}\n            {currentQuestion.type === 'multiple_choice' && currentQuestion.options && (\n              <div className=\"mb-4\">\n                <p className=\"text-sm text-gray-600 mb-2\">Opciones:</p>\n                <ul className=\"list-disc pl-5\">\n                  {currentQuestion.options.map((option, idx) => (\n                    <li key={idx} className=\"mb-1\">{option}</li>\n                  ))}\n                </ul>\n              </div>\n            )}\n            \n            {/* Área de respuesta */}\n            <div className=\"mt-4\">\n              <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                Tu respuesta:\n              </label>\n              <textarea\n                value={currentResponse}\n                onChange={handleResponseChange}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500\"\n                rows=\"3\"\n                placeholder=\"Escribe tu respuesta...\"\n              ></textarea>\n              \n              {/* Controles de reconocimiento de voz */}\n              <div className=\"flex items-center mt-2\">\n                {voiceEnabled && micPermission === 'granted' && !isListening ? (\n                  <button\n                    onClick={startVoiceRecognition}\n                    className=\"flex items-center px-3 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 shadow-sm\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Responder por voz\n                  </button>\n                ) : voiceEnabled && micPermission === 'granted' && isListening ? (\n                  <button\n                    onClick={stopVoiceRecognition}\n                    className=\"flex items-center px-3 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 shadow-sm animate-pulse\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Detener grabación\n                  </button>\n                ) : voiceEnabled && micPermission === 'unknown' ? (\n                  <button\n                    onClick={requestMicrophonePermission}\n                    className=\"flex items-center px-3 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 shadow-sm\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path d=\"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z\" />\n                    </svg>\n                    Permitir micrófono\n                  </button>\n                ) : voiceEnabled && micPermission === 'denied' ? (\n                  <button\n                    onClick={requestMicrophonePermission}\n                    className=\"flex items-center px-3 py-2 bg-red-100 text-red-700 rounded-md hover:bg-red-200 shadow-sm border border-red-300\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Micrófono bloqueado\n                  </button>\n                ) : (\n                  <button\n                    onClick={() => {\n                      setVoiceEnabled(true);\n                      requestMicrophonePermission();\n                    }}\n                    className=\"flex items-center px-3 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 shadow-sm\"\n                  >\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5 mr-2\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                      <path fillRule=\"evenodd\" d=\"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z\" clipRule=\"evenodd\" />\n                    </svg>\n                    Activar modo voz\n                  </button>\n                )}\n                \n                {isListening && (\n                  <span className=\"ml-2 text-green-600 flex items-center animate-pulse\">\n                    <span className=\"w-2 h-2 bg-green-600 rounded-full mr-1 animate-ping\"></span>\n                    Escuchando...\n                  </span>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          {/* Botones de navegación */}\n          <div className=\"flex justify-between\">\n            <button\n              onClick={handlePreviousQuestion}\n              disabled={currentQuestionIndex === 0}\n              className={`px-4 py-2 rounded ${\n                currentQuestionIndex === 0\n                  ? 'bg-gray-200 text-gray-400 cursor-not-allowed'\n                  : 'bg-gray-200 text-gray-800 hover:bg-gray-300'\n              }`}\n            >\n              Anterior\n            </button>\n            \n            <button\n              onClick={handleNextQuestion}\n              className=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\n            >\n              {currentQuestionIndex < survey.questions.length - 1 ? 'Siguiente' : 'Finalizar'}\n            </button>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default TakeSurvey;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}